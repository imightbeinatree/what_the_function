<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'><head><title>/Library/Ruby/Gems/1.8/gems/actionpack-2.1.1/lib/action_controller/base.rb - C0 code coverage information</title>
    <style type='text/css'>body { background-color: rgb(240, 240, 245); }</style>
    <style type='text/css'>span.cross-ref-title {
 font-size: 140%;
}
span.cross-ref a {
 text-decoration: none;
}
span.cross-ref {
 background-color:#f3f7fa;
 border: 1px dashed #333;
 margin: 1em;
 padding: 0.5em;
 overflow: hidden;
}
a.crossref-toggle {
 text-decoration: none;
}
span.marked0 {
 background-color: rgb(185, 210, 200);
 display: block;
}
span.marked1 {
 background-color: rgb(190, 215, 205);
 display: block;
}
span.inferred0 {
 background-color: rgb(175, 200, 200);
 display: block;
}
span.inferred1 {
 background-color: rgb(180, 205, 205);
 display: block;
}
span.uncovered0 {
 background-color: rgb(225, 110, 110);
 display: block;
}
span.uncovered1 {
 background-color: rgb(235, 120, 120);
 display: block;
}
span.overview {
 border-bottom: 8px solid black;
}
div.overview {
 border-bottom: 8px solid black;
}
body {
 font-family: verdana, arial, helvetica;
}
div.footer {
 font-size: 68%;
 margin-top: 1.5em;
}
h1, h2, h3, h4, h5, h6 {
 margin-bottom: 0.5em;
}
h5 {
 margin-top: 0.5em;
}
.hidden {
 display: none;
}
div.separator {
 height: 10px;
}
/* Commented out for better readability, esp. on IE */
/*
table tr td, table tr th {
 font-size: 68%;
}
td.value table tr td {
 font-size: 11px;
}
*/
table.percent_graph {
 height: 12px;
 border: #808080 1px solid;
 empty-cells: show;
}
table.percent_graph td.covered {
 height: 10px;
 background: #00f000;
}
table.percent_graph td.uncovered {
 height: 10px;
 background: #e00000;
}
table.percent_graph td.NA {
 height: 10px;
 background: #eaeaea;
}
table.report {
 border-collapse: collapse;
 width: 100%;
}
table.report td.heading {
 background: #dcecff;
 border: #d0d0d0 1px solid;
 font-weight: bold;
 text-align: center;
}
table.report td.heading:hover {
 background: #c0ffc0;
}
table.report td.text {
 border: #d0d0d0 1px solid;
}
table.report td.value,
table.report td.lines_total,
table.report td.lines_code {
 text-align: right;
 border: #d0d0d0 1px solid;
}
table.report tr.light {
 background-color: rgb(240, 240, 245);
}
table.report tr.dark {
 background-color: rgb(230, 230, 235);
}
</style>
    <script type='text/javascript'>
// <![CDATA[
  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make cross-references hidden by default
  document.writeln( "<style type=\"text/css\">span.cross-ref { display: none }</style>" )
  // ]]>
</script>
    <style type='text/css'>span.run0 {
  background-color: rgb(178, 204, 255);
  display: block;
}
span.run1 {
  background-color: rgb(178, 206, 255);
  display: block;
}
span.run2 {
  background-color: rgb(178, 209, 255);
  display: block;
}
span.run3 {
  background-color: rgb(178, 211, 255);
  display: block;
}
span.run4 {
  background-color: rgb(178, 214, 255);
  display: block;
}
span.run5 {
  background-color: rgb(178, 218, 255);
  display: block;
}
span.run6 {
  background-color: rgb(178, 220, 255);
  display: block;
}
span.run7 {
  background-color: rgb(178, 223, 255);
  display: block;
}
span.run8 {
  background-color: rgb(178, 225, 255);
  display: block;
}
span.run9 {
  background-color: rgb(178, 228, 255);
  display: block;
}
span.run10 {
  background-color: rgb(178, 232, 255);
  display: block;
}
span.run11 {
  background-color: rgb(178, 234, 255);
  display: block;
}
span.run12 {
  background-color: rgb(178, 237, 255);
  display: block;
}
span.run13 {
  background-color: rgb(178, 239, 255);
  display: block;
}
span.run14 {
  background-color: rgb(178, 242, 255);
  display: block;
}
span.run15 {
  background-color: rgb(178, 246, 255);
  display: block;
}
span.run16 {
  background-color: rgb(178, 248, 255);
  display: block;
}
span.run17 {
  background-color: rgb(178, 251, 255);
  display: block;
}
span.run18 {
  background-color: rgb(178, 253, 255);
  display: block;
}
span.run19 {
  background-color: rgb(178, 255, 253);
  display: block;
}
span.run20 {
  background-color: rgb(178, 255, 249);
  display: block;
}
span.run21 {
  background-color: rgb(178, 255, 247);
  display: block;
}
span.run22 {
  background-color: rgb(178, 255, 244);
  display: block;
}
span.run23 {
  background-color: rgb(178, 255, 242);
  display: block;
}
span.run24 {
  background-color: rgb(178, 255, 239);
  display: block;
}
span.run25 {
  background-color: rgb(178, 255, 235);
  display: block;
}
span.run26 {
  background-color: rgb(178, 255, 233);
  display: block;
}
span.run27 {
  background-color: rgb(178, 255, 230);
  display: block;
}
span.run28 {
  background-color: rgb(178, 255, 228);
  display: block;
}
span.run29 {
  background-color: rgb(178, 255, 225);
  display: block;
}
span.run30 {
  background-color: rgb(178, 255, 221);
  display: block;
}
span.run31 {
  background-color: rgb(178, 255, 219);
  display: block;
}
span.run32 {
  background-color: rgb(178, 255, 216);
  display: block;
}
span.run33 {
  background-color: rgb(178, 255, 214);
  display: block;
}
span.run34 {
  background-color: rgb(178, 255, 211);
  display: block;
}
span.run35 {
  background-color: rgb(178, 255, 207);
  display: block;
}
span.run36 {
  background-color: rgb(178, 255, 205);
  display: block;
}
span.run37 {
  background-color: rgb(178, 255, 202);
  display: block;
}
span.run38 {
  background-color: rgb(178, 255, 200);
  display: block;
}
span.run39 {
  background-color: rgb(178, 255, 197);
  display: block;
}
span.run40 {
  background-color: rgb(178, 255, 193);
  display: block;
}
span.run41 {
  background-color: rgb(178, 255, 191);
  display: block;
}
span.run42 {
  background-color: rgb(178, 255, 188);
  display: block;
}
span.run43 {
  background-color: rgb(178, 255, 186);
  display: block;
}
span.run44 {
  background-color: rgb(178, 255, 183);
  display: block;
}
span.run45 {
  background-color: rgb(178, 255, 179);
  display: block;
}
span.run46 {
  background-color: rgb(179, 255, 178);
  display: block;
}
span.run47 {
  background-color: rgb(182, 255, 178);
  display: block;
}
span.run48 {
  background-color: rgb(184, 255, 178);
  display: block;
}
span.run49 {
  background-color: rgb(187, 255, 178);
  display: block;
}
span.run50 {
  background-color: rgb(191, 255, 178);
  display: block;
}
span.run51 {
  background-color: rgb(193, 255, 178);
  display: block;
}
span.run52 {
  background-color: rgb(196, 255, 178);
  display: block;
}
span.run53 {
  background-color: rgb(198, 255, 178);
  display: block;
}
span.run54 {
  background-color: rgb(201, 255, 178);
  display: block;
}
span.run55 {
  background-color: rgb(205, 255, 178);
  display: block;
}
span.run56 {
  background-color: rgb(207, 255, 178);
  display: block;
}
span.run57 {
  background-color: rgb(210, 255, 178);
  display: block;
}
span.run58 {
  background-color: rgb(212, 255, 178);
  display: block;
}
span.run59 {
  background-color: rgb(215, 255, 178);
  display: block;
}
span.run60 {
  background-color: rgb(219, 255, 178);
  display: block;
}
span.run61 {
  background-color: rgb(221, 255, 178);
  display: block;
}
span.run62 {
  background-color: rgb(224, 255, 178);
  display: block;
}
span.run63 {
  background-color: rgb(226, 255, 178);
  display: block;
}
span.run64 {
  background-color: rgb(229, 255, 178);
  display: block;
}
span.run65 {
  background-color: rgb(233, 255, 178);
  display: block;
}
span.run66 {
  background-color: rgb(235, 255, 178);
  display: block;
}
span.run67 {
  background-color: rgb(238, 255, 178);
  display: block;
}
span.run68 {
  background-color: rgb(240, 255, 178);
  display: block;
}
span.run69 {
  background-color: rgb(243, 255, 178);
  display: block;
}
span.run70 {
  background-color: rgb(247, 255, 178);
  display: block;
}
span.run71 {
  background-color: rgb(249, 255, 178);
  display: block;
}
span.run72 {
  background-color: rgb(252, 255, 178);
  display: block;
}
span.run73 {
  background-color: rgb(255, 255, 178);
  display: block;
}
span.run74 {
  background-color: rgb(255, 252, 178);
  display: block;
}
span.run75 {
  background-color: rgb(255, 248, 178);
  display: block;
}
span.run76 {
  background-color: rgb(255, 246, 178);
  display: block;
}
span.run77 {
  background-color: rgb(255, 243, 178);
  display: block;
}
span.run78 {
  background-color: rgb(255, 240, 178);
  display: block;
}
span.run79 {
  background-color: rgb(255, 238, 178);
  display: block;
}
span.run80 {
  background-color: rgb(255, 234, 178);
  display: block;
}
span.run81 {
  background-color: rgb(255, 232, 178);
  display: block;
}
span.run82 {
  background-color: rgb(255, 229, 178);
  display: block;
}
span.run83 {
  background-color: rgb(255, 226, 178);
  display: block;
}
span.run84 {
  background-color: rgb(255, 224, 178);
  display: block;
}
span.run85 {
  background-color: rgb(255, 220, 178);
  display: block;
}
span.run86 {
  background-color: rgb(255, 218, 178);
  display: block;
}
span.run87 {
  background-color: rgb(255, 215, 178);
  display: block;
}
span.run88 {
  background-color: rgb(255, 212, 178);
  display: block;
}
span.run89 {
  background-color: rgb(255, 210, 178);
  display: block;
}
span.run90 {
  background-color: rgb(255, 206, 178);
  display: block;
}
span.run91 {
  background-color: rgb(255, 204, 178);
  display: block;
}
span.run92 {
  background-color: rgb(255, 201, 178);
  display: block;
}
span.run93 {
  background-color: rgb(255, 198, 178);
  display: block;
}
span.run94 {
  background-color: rgb(255, 196, 178);
  display: block;
}
span.run95 {
  background-color: rgb(255, 192, 178);
  display: block;
}
span.run96 {
  background-color: rgb(255, 189, 178);
  display: block;
}
span.run97 {
  background-color: rgb(255, 187, 178);
  display: block;
}
span.run98 {
  background-color: rgb(255, 184, 178);
  display: block;
}
span.run99 {
  background-color: rgb(255, 182, 178);
  display: block;
}
span.run100 {
  background-color: rgb(255, 178, 178);
  display: block;
}
</style>
    </head>
  <body><h3>C0 code coverage information</h3>
    <p>Generated on Tue Nov 11 15:29:49 -0500 2008 with <a href='http://eigenclass.org/hiki/rcov'>rcov 0.8.1.2</a>
      </p>
    <hr/>
    <pre><span class='marked0'>Code reported as executed by Ruby looks like this...
</span><span class='marked1'>and this: this line is also marked as covered.
</span><span class='inferred0'>Lines considered as run by rcov, but not reported by Ruby, look like this,
</span><span class='inferred1'>and this: these lines were inferred by rcov (using simple heuristics).
</span><span class='uncovered0'>Finally, here&apos;s a line marked as not executed.
</span></pre>                       
<table class='report'><thead><tr><td class='heading'>Name</td>
      <td class='heading'>Total lines</td>
      <td class='heading'>Lines of code</td>
      <td class='heading'>Total coverage</td>
      <td class='heading'>Code coverage</td>
      </tr>
    </thead>
  <tbody><tr class='light'><td><a href='-Library-Ruby-Gems-1_8-gems-actionpack-2_1_1-lib-action_controller-base_rb.html'>/Library/Ruby/Gems/1.8/gems/actionpack-2.1.1/lib/action_controller/base.rb</a>
        </td>
      <td class='lines_total'><tt>1274</tt>
        </td>
      <td class='lines_code'><tt>517</tt>
        </td>
      <td><table cellspacing='0' cellpadding='0' align='right'><tr><td><tt class='coverage_total'>68.8%</tt>
              &nbsp;</td>
            <td><table cellspacing='0' class='percent_graph' cellpadding='0' width='100'><tr><td class='covered' width='69'/>
                  <td class='uncovered' width='31'/>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      <td><table cellspacing='0' cellpadding='0' align='right'><tr><td><tt class='coverage_code'>30.6%</tt>
              &nbsp;</td>
            <td><table cellspacing='0' class='percent_graph' cellpadding='0' width='100'><tr><td class='covered' width='31'/>
                  <td class='uncovered' width='69'/>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </tbody>
  </table>
<pre><span class="marked0"><a name="line1"></a>   1 require 'action_controller/mime_type'
</span><span class="marked1"><a name="line2"></a>   2 require 'action_controller/request'
</span><span class="marked0"><a name="line3"></a>   3 require 'action_controller/response'
</span><span class="marked1"><a name="line4"></a>   4 require 'action_controller/routing'
</span><span class="marked0"><a name="line5"></a>   5 require 'action_controller/resources'
</span><span class="marked1"><a name="line6"></a>   6 require 'action_controller/url_rewriter'
</span><span class="marked0"><a name="line7"></a>   7 require 'action_controller/status_codes'
</span><span class="marked1"><a name="line8"></a>   8 require 'action_view'
</span><span class="marked0"><a name="line9"></a>   9 require 'drb'
</span><span class="marked1"><a name="line10"></a>  10 require 'set'
</span><span class="inferred0"><a name="line11"></a>  11 
</span><span class="marked1"><a name="line12"></a>  12 module ActionController #:nodoc:
</span><span class="marked0"><a name="line13"></a>  13   class ActionControllerError &lt; StandardError #:nodoc:
</span><span class="inferred1"><a name="line14"></a>  14   end
</span><span class="inferred0"><a name="line15"></a>  15 
</span><span class="marked1"><a name="line16"></a>  16   class SessionRestoreError &lt; ActionControllerError #:nodoc:
</span><span class="inferred0"><a name="line17"></a>  17   end
</span><span class="inferred1"><a name="line18"></a>  18 
</span><span class="marked0"><a name="line19"></a>  19   class RenderError &lt; ActionControllerError #:nodoc:
</span><span class="inferred1"><a name="line20"></a>  20   end
</span><span class="inferred0"><a name="line21"></a>  21 
</span><span class="marked1"><a name="line22"></a>  22   class RoutingError &lt; ActionControllerError #:nodoc:
</span><span class="marked0"><a name="line23"></a>  23     attr_reader :failures
</span><span class="marked1"><a name="line24"></a>  24     def initialize(message, failures=[])
</span><span class="uncovered0"><a name="line25"></a>  25       super(message)
</span><span class="uncovered1"><a name="line26"></a>  26       @failures = failures
</span><span class="uncovered0"><a name="line27"></a>  27     end
</span><span class="uncovered1"><a name="line28"></a>  28   end
</span><span class="inferred0"><a name="line29"></a>  29 
</span><span class="marked1"><a name="line30"></a>  30   class MethodNotAllowed &lt; ActionControllerError #:nodoc:
</span><span class="marked0"><a name="line31"></a>  31     attr_reader :allowed_methods
</span><span class="inferred1"><a name="line32"></a>  32 
</span><span class="marked0"><a name="line33"></a>  33     def initialize(*allowed_methods)
</span><span class="uncovered1"><a name="line34"></a>  34       super(&quot;Only #{allowed_methods.to_sentence} requests are allowed.&quot;)
</span><span class="uncovered0"><a name="line35"></a>  35       @allowed_methods = allowed_methods
</span><span class="uncovered1"><a name="line36"></a>  36     end
</span><span class="inferred0"><a name="line37"></a>  37 
</span><span class="marked1"><a name="line38"></a>  38     def allowed_methods_header
</span><span class="uncovered0"><a name="line39"></a>  39       allowed_methods.map { |method_symbol| method_symbol.to_s.upcase } * ', '
</span><span class="uncovered1"><a name="line40"></a>  40     end
</span><span class="inferred0"><a name="line41"></a>  41 
</span><span class="marked1"><a name="line42"></a>  42     def handle_response!(response)
</span><span class="uncovered0"><a name="line43"></a>  43       response.headers['Allow'] ||= allowed_methods_header
</span><span class="uncovered1"><a name="line44"></a>  44     end
</span><span class="uncovered0"><a name="line45"></a>  45   end
</span><span class="inferred1"><a name="line46"></a>  46 
</span><span class="marked0"><a name="line47"></a>  47   class NotImplemented &lt; MethodNotAllowed #:nodoc:
</span><span class="inferred1"><a name="line48"></a>  48   end
</span><span class="inferred0"><a name="line49"></a>  49 
</span><span class="marked1"><a name="line50"></a>  50   class UnknownController &lt; ActionControllerError #:nodoc:
</span><span class="inferred0"><a name="line51"></a>  51   end
</span><span class="inferred1"><a name="line52"></a>  52 
</span><span class="marked0"><a name="line53"></a>  53   class UnknownAction &lt; ActionControllerError #:nodoc:
</span><span class="inferred1"><a name="line54"></a>  54   end
</span><span class="inferred0"><a name="line55"></a>  55 
</span><span class="marked1"><a name="line56"></a>  56   class MissingFile &lt; ActionControllerError #:nodoc:
</span><span class="inferred0"><a name="line57"></a>  57   end
</span><span class="inferred1"><a name="line58"></a>  58 
</span><span class="marked0"><a name="line59"></a>  59   class RenderError &lt; ActionControllerError #:nodoc:
</span><span class="inferred1"><a name="line60"></a>  60   end
</span><span class="inferred0"><a name="line61"></a>  61 
</span><span class="marked1"><a name="line62"></a>  62   class SessionOverflowError &lt; ActionControllerError #:nodoc:
</span><span class="marked0"><a name="line63"></a>  63     DEFAULT_MESSAGE = 'Your session data is larger than the data column in which it is to be stored. You must increase the size of your data column if you intend to store large data.'
</span><span class="inferred1"><a name="line64"></a>  64 
</span><span class="marked0"><a name="line65"></a>  65     def initialize(message = nil)
</span><span class="uncovered1"><a name="line66"></a>  66       super(message || DEFAULT_MESSAGE)
</span><span class="uncovered0"><a name="line67"></a>  67     end
</span><span class="uncovered1"><a name="line68"></a>  68   end
</span><span class="inferred0"><a name="line69"></a>  69 
</span><span class="marked1"><a name="line70"></a>  70   class DoubleRenderError &lt; ActionControllerError #:nodoc:
</span><span class="marked0"><a name="line71"></a>  71     DEFAULT_MESSAGE = &quot;Render and/or redirect were called multiple times in this action. Please note that you may only call render OR redirect, and at most once per action. Also note that neither redirect nor render terminate execution of the action, so if you want to exit an action after redirecting, you need to do something like \&quot;redirect_to(...) and return\&quot;.&quot;
</span><span class="inferred1"><a name="line72"></a>  72 
</span><span class="marked0"><a name="line73"></a>  73     def initialize(message = nil)
</span><span class="uncovered1"><a name="line74"></a>  74       super(message || DEFAULT_MESSAGE)
</span><span class="uncovered0"><a name="line75"></a>  75     end
</span><span class="uncovered1"><a name="line76"></a>  76   end
</span><span class="inferred0"><a name="line77"></a>  77 
</span><span class="marked1"><a name="line78"></a>  78   class RedirectBackError &lt; ActionControllerError #:nodoc:
</span><span class="marked0"><a name="line79"></a>  79     DEFAULT_MESSAGE = 'No HTTP_REFERER was set in the request to this action, so redirect_to :back could not be called successfully. If this is a test, make sure to specify request.env[&quot;HTTP_REFERER&quot;].'
</span><span class="inferred1"><a name="line80"></a>  80 
</span><span class="marked0"><a name="line81"></a>  81     def initialize(message = nil)
</span><span class="uncovered1"><a name="line82"></a>  82       super(message || DEFAULT_MESSAGE)
</span><span class="uncovered0"><a name="line83"></a>  83     end
</span><span class="uncovered1"><a name="line84"></a>  84   end
</span><span class="inferred0"><a name="line85"></a>  85 
</span><span class="marked1"><a name="line86"></a>  86   class UnknownHttpMethod &lt; ActionControllerError #:nodoc:
</span><span class="inferred0"><a name="line87"></a>  87   end
</span><span class="inferred1"><a name="line88"></a>  88 
</span><span class="inferred0"><a name="line89"></a>  89   # Action Controllers are the core of a web request in Rails. They are made up of one or more actions that are executed
</span><span class="inferred1"><a name="line90"></a>  90   # on request and then either render a template or redirect to another action. An action is defined as a public method
</span><span class="inferred0"><a name="line91"></a>  91   # on the controller, which will automatically be made accessible to the web-server through Rails Routes.
</span><span class="inferred1"><a name="line92"></a>  92   #
</span><span class="inferred0"><a name="line93"></a>  93   # A sample controller could look like this:
</span><span class="inferred1"><a name="line94"></a>  94   #
</span><span class="inferred0"><a name="line95"></a>  95   #   class GuestBookController &lt; ActionController::Base
</span><span class="inferred1"><a name="line96"></a>  96   #     def index
</span><span class="inferred0"><a name="line97"></a>  97   #       @entries = Entry.find(:all)
</span><span class="inferred1"><a name="line98"></a>  98   #     end
</span><span class="inferred0"><a name="line99"></a>  99   #
</span><span class="inferred1"><a name="line100"></a> 100   #     def sign
</span><span class="inferred0"><a name="line101"></a> 101   #       Entry.create(params[:entry])
</span><span class="inferred1"><a name="line102"></a> 102   #       redirect_to :action =&gt; &quot;index&quot;
</span><span class="inferred0"><a name="line103"></a> 103   #     end
</span><span class="inferred1"><a name="line104"></a> 104   #   end
</span><span class="inferred0"><a name="line105"></a> 105   #
</span><span class="inferred1"><a name="line106"></a> 106   # Actions, by default, render a template in the &lt;tt&gt;app/views&lt;/tt&gt; directory corresponding to the name of the controller and action
</span><span class="inferred0"><a name="line107"></a> 107   # after executing code in the action. For example, the +index+ action of the GuestBookController would render the
</span><span class="inferred1"><a name="line108"></a> 108   # template &lt;tt&gt;app/views/guestbook/index.erb&lt;/tt&gt; by default after populating the &lt;tt&gt;@entries&lt;/tt&gt; instance variable.
</span><span class="inferred0"><a name="line109"></a> 109   #
</span><span class="inferred1"><a name="line110"></a> 110   # Unlike index, the sign action will not render a template. After performing its main purpose (creating a
</span><span class="inferred0"><a name="line111"></a> 111   # new entry in the guest book), it initiates a redirect instead. This redirect works by returning an external
</span><span class="inferred1"><a name="line112"></a> 112   # &quot;302 Moved&quot; HTTP response that takes the user to the index action.
</span><span class="inferred0"><a name="line113"></a> 113   #
</span><span class="inferred1"><a name="line114"></a> 114   # The index and sign represent the two basic action archetypes used in Action Controllers. Get-and-show and do-and-redirect.
</span><span class="inferred0"><a name="line115"></a> 115   # Most actions are variations of these themes.
</span><span class="inferred1"><a name="line116"></a> 116   #
</span><span class="inferred0"><a name="line117"></a> 117   # == Requests
</span><span class="inferred1"><a name="line118"></a> 118   #
</span><span class="inferred0"><a name="line119"></a> 119   # Requests are processed by the Action Controller framework by extracting the value of the &quot;action&quot; key in the request parameters.
</span><span class="inferred1"><a name="line120"></a> 120   # This value should hold the name of the action to be performed. Once the action has been identified, the remaining
</span><span class="inferred0"><a name="line121"></a> 121   # request parameters, the session (if one is available), and the full request with all the HTTP headers are made available to
</span><span class="inferred1"><a name="line122"></a> 122   # the action through instance variables. Then the action is performed.
</span><span class="inferred0"><a name="line123"></a> 123   #
</span><span class="inferred1"><a name="line124"></a> 124   # The full request object is available with the request accessor and is primarily used to query for HTTP headers. These queries
</span><span class="inferred0"><a name="line125"></a> 125   # are made by accessing the environment hash, like this:
</span><span class="inferred1"><a name="line126"></a> 126   #
</span><span class="inferred0"><a name="line127"></a> 127   #   def server_ip
</span><span class="inferred1"><a name="line128"></a> 128   #     location = request.env[&quot;SERVER_ADDR&quot;]
</span><span class="inferred0"><a name="line129"></a> 129   #     render :text =&gt; &quot;This server hosted at #{location}&quot;
</span><span class="inferred1"><a name="line130"></a> 130   #   end
</span><span class="inferred0"><a name="line131"></a> 131   #
</span><span class="inferred1"><a name="line132"></a> 132   # == Parameters
</span><span class="inferred0"><a name="line133"></a> 133   #
</span><span class="inferred1"><a name="line134"></a> 134   # All request parameters, whether they come from a GET or POST request, or from the URL, are available through the params method
</span><span class="inferred0"><a name="line135"></a> 135   # which returns a hash. For example, an action that was performed through &lt;tt&gt;/weblog/list?category=All&amp;limit=5&lt;/tt&gt; will include
</span><span class="inferred1"><a name="line136"></a> 136   # &lt;tt&gt;{ &quot;category&quot; =&gt; &quot;All&quot;, &quot;limit&quot; =&gt; 5 }&lt;/tt&gt; in params.
</span><span class="inferred0"><a name="line137"></a> 137   #
</span><span class="inferred1"><a name="line138"></a> 138   # It's also possible to construct multi-dimensional parameter hashes by specifying keys using brackets, such as:
</span><span class="inferred0"><a name="line139"></a> 139   #
</span><span class="inferred1"><a name="line140"></a> 140   #   &lt;input type=&quot;text&quot; name=&quot;post[name]&quot; value=&quot;david&quot;&gt;
</span><span class="inferred0"><a name="line141"></a> 141   #   &lt;input type=&quot;text&quot; name=&quot;post[address]&quot; value=&quot;hyacintvej&quot;&gt;
</span><span class="inferred1"><a name="line142"></a> 142   #
</span><span class="inferred0"><a name="line143"></a> 143   # A request stemming from a form holding these inputs will include &lt;tt&gt;{ &quot;post&quot; =&gt; { &quot;name&quot; =&gt; &quot;david&quot;, &quot;address&quot; =&gt; &quot;hyacintvej&quot; } }&lt;/tt&gt;.
</span><span class="inferred1"><a name="line144"></a> 144   # If the address input had been named &quot;post[address][street]&quot;, the params would have included
</span><span class="inferred0"><a name="line145"></a> 145   # &lt;tt&gt;{ &quot;post&quot; =&gt; { &quot;address&quot; =&gt; { &quot;street&quot; =&gt; &quot;hyacintvej&quot; } } }&lt;/tt&gt;. There's no limit to the depth of the nesting.
</span><span class="inferred1"><a name="line146"></a> 146   #
</span><span class="inferred0"><a name="line147"></a> 147   # == Sessions
</span><span class="inferred1"><a name="line148"></a> 148   #
</span><span class="inferred0"><a name="line149"></a> 149   # Sessions allows you to store objects in between requests. This is useful for objects that are not yet ready to be persisted,
</span><span class="inferred1"><a name="line150"></a> 150   # such as a Signup object constructed in a multi-paged process, or objects that don't change much and are needed all the time, such
</span><span class="inferred0"><a name="line151"></a> 151   # as a User object for a system that requires login. The session should not be used, however, as a cache for objects where it's likely
</span><span class="inferred1"><a name="line152"></a> 152   # they could be changed unknowingly. It's usually too much work to keep it all synchronized -- something databases already excel at.
</span><span class="inferred0"><a name="line153"></a> 153   #
</span><span class="inferred1"><a name="line154"></a> 154   # You can place objects in the session by using the &lt;tt&gt;session&lt;/tt&gt; method, which accesses a hash:
</span><span class="inferred0"><a name="line155"></a> 155   #
</span><span class="inferred1"><a name="line156"></a> 156   #   session[:person] = Person.authenticate(user_name, password)
</span><span class="inferred0"><a name="line157"></a> 157   #
</span><span class="inferred1"><a name="line158"></a> 158   # And retrieved again through the same hash:
</span><span class="inferred0"><a name="line159"></a> 159   #
</span><span class="inferred1"><a name="line160"></a> 160   #   Hello #{session[:person]}
</span><span class="inferred0"><a name="line161"></a> 161   #
</span><span class="inferred1"><a name="line162"></a> 162   # For removing objects from the session, you can either assign a single key to +nil+:
</span><span class="inferred0"><a name="line163"></a> 163   #
</span><span class="inferred1"><a name="line164"></a> 164   #   # removes :person from session
</span><span class="inferred0"><a name="line165"></a> 165   #   session[:person] = nil
</span><span class="inferred1"><a name="line166"></a> 166   #
</span><span class="inferred0"><a name="line167"></a> 167   # or you can remove the entire session with +reset_session+.
</span><span class="inferred1"><a name="line168"></a> 168   #
</span><span class="inferred0"><a name="line169"></a> 169   # Sessions are stored by default in a browser cookie that's cryptographically signed, but unencrypted.
</span><span class="inferred1"><a name="line170"></a> 170   # This prevents the user from tampering with the session but also allows him to see its contents.
</span><span class="inferred0"><a name="line171"></a> 171   #
</span><span class="inferred1"><a name="line172"></a> 172   # Do not put secret information in cookie-based sessions!
</span><span class="inferred0"><a name="line173"></a> 173   #
</span><span class="inferred1"><a name="line174"></a> 174   # Other options for session storage are:
</span><span class="inferred0"><a name="line175"></a> 175   #
</span><span class="inferred1"><a name="line176"></a> 176   # * ActiveRecordStore - Sessions are stored in your database, which works better than PStore with multiple app servers and,
</span><span class="inferred0"><a name="line177"></a> 177   #   unlike CookieStore, hides your session contents from the user. To use ActiveRecordStore, set
</span><span class="inferred1"><a name="line178"></a> 178   #
</span><span class="inferred0"><a name="line179"></a> 179   #     config.action_controller.session_store = :active_record_store
</span><span class="inferred1"><a name="line180"></a> 180   #
</span><span class="inferred0"><a name="line181"></a> 181   #   in your &lt;tt&gt;config/environment.rb&lt;/tt&gt; and run &lt;tt&gt;rake db:sessions:create&lt;/tt&gt;.
</span><span class="inferred1"><a name="line182"></a> 182   #
</span><span class="inferred0"><a name="line183"></a> 183   # * MemCacheStore - Sessions are stored as entries in your memcached cache.
</span><span class="inferred1"><a name="line184"></a> 184   #   Set the session store type in &lt;tt&gt;config/environment.rb&lt;/tt&gt;:
</span><span class="inferred0"><a name="line185"></a> 185   #
</span><span class="inferred1"><a name="line186"></a> 186   #     config.action_controller.session_store = :mem_cache_store
</span><span class="inferred0"><a name="line187"></a> 187   #
</span><span class="inferred1"><a name="line188"></a> 188   #   This assumes that memcached has been installed and configured properly.
</span><span class="inferred0"><a name="line189"></a> 189   #   See the MemCacheStore docs for more information.
</span><span class="inferred1"><a name="line190"></a> 190   #
</span><span class="inferred0"><a name="line191"></a> 191   # == Responses
</span><span class="inferred1"><a name="line192"></a> 192   #
</span><span class="inferred0"><a name="line193"></a> 193   # Each action results in a response, which holds the headers and document to be sent to the user's browser. The actual response
</span><span class="inferred1"><a name="line194"></a> 194   # object is generated automatically through the use of renders and redirects and requires no user intervention.
</span><span class="inferred0"><a name="line195"></a> 195   #
</span><span class="inferred1"><a name="line196"></a> 196   # == Renders
</span><span class="inferred0"><a name="line197"></a> 197   #
</span><span class="inferred1"><a name="line198"></a> 198   # Action Controller sends content to the user by using one of five rendering methods. The most versatile and common is the rendering
</span><span class="inferred0"><a name="line199"></a> 199   # of a template. Included in the Action Pack is the Action View, which enables rendering of ERb templates. It's automatically configured.
</span><span class="inferred1"><a name="line200"></a> 200   # The controller passes objects to the view by assigning instance variables:
</span><span class="inferred0"><a name="line201"></a> 201   #
</span><span class="inferred1"><a name="line202"></a> 202   #   def show
</span><span class="inferred0"><a name="line203"></a> 203   #     @post = Post.find(params[:id])
</span><span class="inferred1"><a name="line204"></a> 204   #   end
</span><span class="inferred0"><a name="line205"></a> 205   #
</span><span class="inferred1"><a name="line206"></a> 206   # Which are then automatically available to the view:
</span><span class="inferred0"><a name="line207"></a> 207   #
</span><span class="inferred1"><a name="line208"></a> 208   #   Title: &lt;%= @post.title %&gt;
</span><span class="inferred0"><a name="line209"></a> 209   #
</span><span class="inferred1"><a name="line210"></a> 210   # You don't have to rely on the automated rendering. Especially actions that could result in the rendering of different templates will use
</span><span class="inferred0"><a name="line211"></a> 211   # the manual rendering methods:
</span><span class="inferred1"><a name="line212"></a> 212   #
</span><span class="inferred0"><a name="line213"></a> 213   #   def search
</span><span class="inferred1"><a name="line214"></a> 214   #     @results = Search.find(params[:query])
</span><span class="inferred0"><a name="line215"></a> 215   #     case @results
</span><span class="inferred1"><a name="line216"></a> 216   #       when 0 then render :action =&gt; &quot;no_results&quot;
</span><span class="inferred0"><a name="line217"></a> 217   #       when 1 then render :action =&gt; &quot;show&quot;
</span><span class="inferred1"><a name="line218"></a> 218   #       when 2..10 then render :action =&gt; &quot;show_many&quot;
</span><span class="inferred0"><a name="line219"></a> 219   #     end
</span><span class="inferred1"><a name="line220"></a> 220   #   end
</span><span class="inferred0"><a name="line221"></a> 221   #
</span><span class="inferred1"><a name="line222"></a> 222   # Read more about writing ERb and Builder templates in link:classes/ActionView/Base.html.
</span><span class="inferred0"><a name="line223"></a> 223   #
</span><span class="inferred1"><a name="line224"></a> 224   # == Redirects
</span><span class="inferred0"><a name="line225"></a> 225   #
</span><span class="inferred1"><a name="line226"></a> 226   # Redirects are used to move from one action to another. For example, after a &lt;tt&gt;create&lt;/tt&gt; action, which stores a blog entry to a database,
</span><span class="inferred0"><a name="line227"></a> 227   # we might like to show the user the new entry. Because we're following good DRY principles (Don't Repeat Yourself), we're going to reuse (and redirect to)
</span><span class="inferred1"><a name="line228"></a> 228   # a &lt;tt&gt;show&lt;/tt&gt; action that we'll assume has already been created. The code might look like this:
</span><span class="inferred0"><a name="line229"></a> 229   #
</span><span class="inferred1"><a name="line230"></a> 230   #   def create
</span><span class="inferred0"><a name="line231"></a> 231   #     @entry = Entry.new(params[:entry])
</span><span class="inferred1"><a name="line232"></a> 232   #     if @entry.save
</span><span class="inferred0"><a name="line233"></a> 233   #       # The entry was saved correctly, redirect to show
</span><span class="inferred1"><a name="line234"></a> 234   #       redirect_to :action =&gt; 'show', :id =&gt; @entry.id
</span><span class="inferred0"><a name="line235"></a> 235   #     else
</span><span class="inferred1"><a name="line236"></a> 236   #       # things didn't go so well, do something else
</span><span class="inferred0"><a name="line237"></a> 237   #     end
</span><span class="inferred1"><a name="line238"></a> 238   #   end
</span><span class="inferred0"><a name="line239"></a> 239   #
</span><span class="inferred1"><a name="line240"></a> 240   # In this case, after saving our new entry to the database, the user is redirected to the &lt;tt&gt;show&lt;/tt&gt; method which is then executed.
</span><span class="inferred0"><a name="line241"></a> 241   #
</span><span class="inferred1"><a name="line242"></a> 242   # == Calling multiple redirects or renders
</span><span class="inferred0"><a name="line243"></a> 243   #
</span><span class="inferred1"><a name="line244"></a> 244   # An action may contain only a single render or a single redirect. Attempting to try to do either again will result in a DoubleRenderError:
</span><span class="inferred0"><a name="line245"></a> 245   #
</span><span class="inferred1"><a name="line246"></a> 246   #   def do_something
</span><span class="inferred0"><a name="line247"></a> 247   #     redirect_to :action =&gt; &quot;elsewhere&quot;
</span><span class="inferred1"><a name="line248"></a> 248   #     render :action =&gt; &quot;overthere&quot; # raises DoubleRenderError
</span><span class="inferred0"><a name="line249"></a> 249   #   end
</span><span class="inferred1"><a name="line250"></a> 250   #
</span><span class="inferred0"><a name="line251"></a> 251   # If you need to redirect on the condition of something, then be sure to add &quot;and return&quot; to halt execution.
</span><span class="inferred1"><a name="line252"></a> 252   #
</span><span class="inferred0"><a name="line253"></a> 253   #   def do_something
</span><span class="inferred1"><a name="line254"></a> 254   #     redirect_to(:action =&gt; &quot;elsewhere&quot;) and return if monkeys.nil?
</span><span class="inferred0"><a name="line255"></a> 255   #     render :action =&gt; &quot;overthere&quot; # won't be called unless monkeys is nil
</span><span class="inferred1"><a name="line256"></a> 256   #   end
</span><span class="inferred0"><a name="line257"></a> 257   #
</span><span class="marked1"><a name="line258"></a> 258   class Base
</span><span class="marked0"><a name="line259"></a> 259     DEFAULT_RENDER_STATUS_CODE = &quot;200 OK&quot;
</span><span class="inferred1"><a name="line260"></a> 260 
</span><span class="marked0"><a name="line261"></a> 261     include StatusCodes
</span><span class="inferred1"><a name="line262"></a> 262 
</span><span class="inferred0"><a name="line263"></a> 263     # Controller specific instance variables which will not be accessible inside views.
</span><span class="marked1"><a name="line264"></a> 264     @@protected_view_variables = %w(@assigns @performed_redirect @performed_render @variables_added @request_origin @url @parent_controller
</span><span class="inferred0"><a name="line265"></a> 265                                     @action_name @before_filter_chain_aborted @action_cache_path @_session @_cookies @_headers @_params
</span><span class="inferred1"><a name="line266"></a> 266                                     @_flash @_response)
</span><span class="inferred0"><a name="line267"></a> 267 
</span><span class="inferred1"><a name="line268"></a> 268     # Prepends all the URL-generating helpers from AssetHelper. This makes it possible to easily move javascripts, stylesheets,
</span><span class="inferred0"><a name="line269"></a> 269     # and images to a dedicated asset server away from the main web server. Example:
</span><span class="inferred1"><a name="line270"></a> 270     #   ActionController::Base.asset_host = &quot;http://assets.example.com&quot;
</span><span class="marked0"><a name="line271"></a> 271     @@asset_host = &quot;&quot;
</span><span class="marked1"><a name="line272"></a> 272     cattr_accessor :asset_host
</span><span class="inferred0"><a name="line273"></a> 273 
</span><span class="inferred1"><a name="line274"></a> 274     # All requests are considered local by default, so everyone will be exposed to detailed debugging screens on errors.
</span><span class="inferred0"><a name="line275"></a> 275     # When the application is ready to go public, this should be set to false, and the protected method &lt;tt&gt;local_request?&lt;/tt&gt;
</span><span class="inferred1"><a name="line276"></a> 276     # should instead be implemented in the controller to determine when debugging screens should be shown.
</span><span class="marked0"><a name="line277"></a> 277     @@consider_all_requests_local = true
</span><span class="marked1"><a name="line278"></a> 278     cattr_accessor :consider_all_requests_local
</span><span class="inferred0"><a name="line279"></a> 279 
</span><span class="inferred1"><a name="line280"></a> 280     # Enable or disable the collection of failure information for RoutingErrors.
</span><span class="inferred0"><a name="line281"></a> 281     # This information can be extremely useful when tweaking custom routes, but is
</span><span class="inferred1"><a name="line282"></a> 282     # pointless once routes have been tested and verified.
</span><span class="marked0"><a name="line283"></a> 283     @@debug_routes = true
</span><span class="marked1"><a name="line284"></a> 284     cattr_accessor :debug_routes
</span><span class="inferred0"><a name="line285"></a> 285 
</span><span class="inferred1"><a name="line286"></a> 286     # Indicates to Mongrel or Webrick whether to allow concurrent action
</span><span class="inferred0"><a name="line287"></a> 287     # processing. Your controller actions and any other code they call must
</span><span class="inferred1"><a name="line288"></a> 288     # also behave well when called from concurrent threads. Turned off by
</span><span class="inferred0"><a name="line289"></a> 289     # default.
</span><span class="marked1"><a name="line290"></a> 290     @@allow_concurrency = false
</span><span class="marked0"><a name="line291"></a> 291     cattr_accessor :allow_concurrency
</span><span class="inferred1"><a name="line292"></a> 292 
</span><span class="inferred0"><a name="line293"></a> 293     # Modern REST web services often need to submit complex data to the web application.
</span><span class="inferred1"><a name="line294"></a> 294     # The &lt;tt&gt;@@param_parsers&lt;/tt&gt; hash lets you register handlers which will process the HTTP body and add parameters to the
</span><span class="inferred0"><a name="line295"></a> 295     # &lt;tt&gt;params&lt;/tt&gt; hash. These handlers are invoked for POST and PUT requests.
</span><span class="inferred1"><a name="line296"></a> 296     #
</span><span class="inferred0"><a name="line297"></a> 297     # By default &lt;tt&gt;application/xml&lt;/tt&gt; is enabled. A XmlSimple class with the same param name as the root will be instantiated
</span><span class="inferred1"><a name="line298"></a> 298     # in the &lt;tt&gt;params&lt;/tt&gt;. This allows XML requests to mask themselves as regular form submissions, so you can have one
</span><span class="inferred0"><a name="line299"></a> 299     # action serve both regular forms and web service requests.
</span><span class="inferred1"><a name="line300"></a> 300     #
</span><span class="inferred0"><a name="line301"></a> 301     # Example of doing your own parser for a custom content type:
</span><span class="inferred1"><a name="line302"></a> 302     #
</span><span class="inferred0"><a name="line303"></a> 303     #   ActionController::Base.param_parsers[Mime::Type.lookup('application/atom+xml')] = Proc.new do |data|
</span><span class="inferred1"><a name="line304"></a> 304     #      node = REXML::Document.new(post)
</span><span class="inferred0"><a name="line305"></a> 305     #     { node.root.name =&gt; node.root }
</span><span class="inferred1"><a name="line306"></a> 306     #   end
</span><span class="inferred0"><a name="line307"></a> 307     #
</span><span class="inferred1"><a name="line308"></a> 308     # Note: Up until release 1.1 of Rails, Action Controller would default to using XmlSimple configured to discard the
</span><span class="inferred0"><a name="line309"></a> 309     # root node for such requests. The new default is to keep the root, such that &quot;&lt;r&gt;&lt;name&gt;David&lt;/name&gt;&lt;/r&gt;&quot; results
</span><span class="inferred1"><a name="line310"></a> 310     # in &lt;tt&gt;params[:r][:name]&lt;/tt&gt; for &quot;David&quot; instead of &lt;tt&gt;params[:name]&lt;/tt&gt;. To get the old behavior, you can
</span><span class="inferred0"><a name="line311"></a> 311     # re-register XmlSimple as application/xml handler ike this:
</span><span class="inferred1"><a name="line312"></a> 312     #
</span><span class="inferred0"><a name="line313"></a> 313     #   ActionController::Base.param_parsers[Mime::XML] =
</span><span class="inferred1"><a name="line314"></a> 314     #     Proc.new { |data| XmlSimple.xml_in(data, 'ForceArray' =&gt; false) }
</span><span class="inferred0"><a name="line315"></a> 315     #
</span><span class="inferred1"><a name="line316"></a> 316     # A YAML parser is also available and can be turned on with:
</span><span class="inferred0"><a name="line317"></a> 317     #
</span><span class="inferred1"><a name="line318"></a> 318     #   ActionController::Base.param_parsers[Mime::YAML] = :yaml
</span><span class="marked0"><a name="line319"></a> 319     @@param_parsers = { Mime::MULTIPART_FORM   =&gt; :multipart_form,
</span><span class="inferred1"><a name="line320"></a> 320                         Mime::URL_ENCODED_FORM =&gt; :url_encoded_form,
</span><span class="inferred0"><a name="line321"></a> 321                         Mime::XML              =&gt; :xml_simple,
</span><span class="inferred1"><a name="line322"></a> 322                         Mime::JSON             =&gt; :json }
</span><span class="marked0"><a name="line323"></a> 323     cattr_accessor :param_parsers
</span><span class="inferred1"><a name="line324"></a> 324 
</span><span class="inferred0"><a name="line325"></a> 325     # Controls the default charset for all renders.
</span><span class="marked1"><a name="line326"></a> 326     @@default_charset = &quot;utf-8&quot;
</span><span class="marked0"><a name="line327"></a> 327     cattr_accessor :default_charset
</span><span class="inferred1"><a name="line328"></a> 328 
</span><span class="inferred0"><a name="line329"></a> 329     # The logger is used for generating information on the action run-time (including benchmarking) if available.
</span><span class="inferred1"><a name="line330"></a> 330     # Can be set to nil for no logging. Compatible with both Ruby's own Logger and Log4r loggers.
</span><span class="marked0"><a name="line331"></a> 331     cattr_accessor :logger
</span><span class="inferred1"><a name="line332"></a> 332 
</span><span class="inferred0"><a name="line333"></a> 333     # Controls the resource action separator
</span><span class="marked1"><a name="line334"></a> 334     @@resource_action_separator = &quot;/&quot;
</span><span class="marked0"><a name="line335"></a> 335     cattr_accessor :resource_action_separator
</span><span class="inferred1"><a name="line336"></a> 336 
</span><span class="inferred0"><a name="line337"></a> 337     # Allow to override path names for default resources' actions
</span><span class="marked1"><a name="line338"></a> 338     @@resources_path_names = { :new =&gt; 'new', :edit =&gt; 'edit' }
</span><span class="marked0"><a name="line339"></a> 339     cattr_accessor :resources_path_names
</span><span class="inferred1"><a name="line340"></a> 340 
</span><span class="inferred0"><a name="line341"></a> 341     # Sets the token parameter name for RequestForgery. Calling +protect_from_forgery+
</span><span class="inferred1"><a name="line342"></a> 342     # sets it to &lt;tt&gt;:authenticity_token&lt;/tt&gt; by default.
</span><span class="marked0"><a name="line343"></a> 343     cattr_accessor :request_forgery_protection_token
</span><span class="inferred1"><a name="line344"></a> 344 
</span><span class="inferred0"><a name="line345"></a> 345     # Indicates whether or not optimise the generated named
</span><span class="inferred1"><a name="line346"></a> 346     # route helper methods
</span><span class="marked0"><a name="line347"></a> 347     cattr_accessor :optimise_named_routes
</span><span class="marked1"><a name="line348"></a> 348     self.optimise_named_routes = true
</span><span class="inferred0"><a name="line349"></a> 349 
</span><span class="inferred1"><a name="line350"></a> 350     # Controls whether request forgergy protection is turned on or not. Turned off by default only in test mode.
</span><span class="marked0"><a name="line351"></a> 351     class_inheritable_accessor :allow_forgery_protection
</span><span class="marked1"><a name="line352"></a> 352     self.allow_forgery_protection = true
</span><span class="inferred0"><a name="line353"></a> 353 
</span><span class="inferred1"><a name="line354"></a> 354     # Holds the request object that's primarily used to get environment variables through access like
</span><span class="inferred0"><a name="line355"></a> 355     # &lt;tt&gt;request.env[&quot;REQUEST_URI&quot;]&lt;/tt&gt;.
</span><span class="marked1"><a name="line356"></a> 356     attr_internal :request
</span><span class="inferred0"><a name="line357"></a> 357 
</span><span class="inferred1"><a name="line358"></a> 358     # Holds a hash of all the GET, POST, and Url parameters passed to the action. Accessed like &lt;tt&gt;params[&quot;post_id&quot;]&lt;/tt&gt;
</span><span class="inferred0"><a name="line359"></a> 359     # to get the post_id. No type casts are made, so all values are returned as strings.
</span><span class="marked1"><a name="line360"></a> 360     attr_internal :params
</span><span class="inferred0"><a name="line361"></a> 361 
</span><span class="inferred1"><a name="line362"></a> 362     # Holds the response object that's primarily used to set additional HTTP headers through access like
</span><span class="inferred0"><a name="line363"></a> 363     # &lt;tt&gt;response.headers[&quot;Cache-Control&quot;] = &quot;no-cache&quot;&lt;/tt&gt;. Can also be used to access the final body HTML after a template
</span><span class="inferred1"><a name="line364"></a> 364     # has been rendered through response.body -- useful for &lt;tt&gt;after_filter&lt;/tt&gt;s that wants to manipulate the output,
</span><span class="inferred0"><a name="line365"></a> 365     # such as a OutputCompressionFilter.
</span><span class="marked1"><a name="line366"></a> 366     attr_internal :response
</span><span class="inferred0"><a name="line367"></a> 367 
</span><span class="inferred1"><a name="line368"></a> 368     # Holds a hash of objects in the session. Accessed like &lt;tt&gt;session[:person]&lt;/tt&gt; to get the object tied to the &quot;person&quot;
</span><span class="inferred0"><a name="line369"></a> 369     # key. The session will hold any type of object as values, but the key should be a string or symbol.
</span><span class="marked1"><a name="line370"></a> 370     attr_internal :session
</span><span class="inferred0"><a name="line371"></a> 371 
</span><span class="inferred1"><a name="line372"></a> 372     # Holds a hash of header names and values. Accessed like &lt;tt&gt;headers[&quot;Cache-Control&quot;]&lt;/tt&gt; to get the value of the Cache-Control
</span><span class="inferred0"><a name="line373"></a> 373     # directive. Values should always be specified as strings.
</span><span class="marked1"><a name="line374"></a> 374     attr_internal :headers
</span><span class="inferred0"><a name="line375"></a> 375 
</span><span class="inferred1"><a name="line376"></a> 376     # Holds the hash of variables that are passed on to the template class to be made available to the view. This hash
</span><span class="inferred0"><a name="line377"></a> 377     # is generated by taking a snapshot of all the instance variables in the current scope just before a template is rendered.
</span><span class="marked1"><a name="line378"></a> 378     attr_accessor :assigns
</span><span class="inferred0"><a name="line379"></a> 379 
</span><span class="inferred1"><a name="line380"></a> 380     # Returns the name of the action this controller is processing.
</span><span class="marked0"><a name="line381"></a> 381     attr_accessor :action_name
</span><span class="inferred1"><a name="line382"></a> 382 
</span><span class="inferred0"><a name="line383"></a> 383     # Templates that are exempt from layouts
</span><span class="marked1"><a name="line384"></a> 384     @@exempt_from_layout = Set.new([/\.rjs$/])
</span><span class="inferred0"><a name="line385"></a> 385 
</span><span class="marked1"><a name="line386"></a> 386     class &lt;&lt; self
</span><span class="inferred0"><a name="line387"></a> 387       # Factory for the standard create, process loop where the controller is discarded after processing.
</span><span class="marked1"><a name="line388"></a> 388       def process(request, response) #:nodoc:
</span><span class="uncovered0"><a name="line389"></a> 389         new.process(request, response)
</span><span class="uncovered1"><a name="line390"></a> 390       end
</span><span class="inferred0"><a name="line391"></a> 391 
</span><span class="inferred1"><a name="line392"></a> 392       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;NeatController&quot;.
</span><span class="marked0"><a name="line393"></a> 393       def controller_class_name
</span><span class="uncovered1"><a name="line394"></a> 394         @controller_class_name ||= name.demodulize
</span><span class="uncovered0"><a name="line395"></a> 395       end
</span><span class="inferred1"><a name="line396"></a> 396 
</span><span class="inferred0"><a name="line397"></a> 397       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;neat&quot;.
</span><span class="marked1"><a name="line398"></a> 398       def controller_name
</span><span class="uncovered0"><a name="line399"></a> 399         @controller_name ||= controller_class_name.sub(/Controller$/, '').underscore
</span><span class="uncovered1"><a name="line400"></a> 400       end
</span><span class="inferred0"><a name="line401"></a> 401 
</span><span class="inferred1"><a name="line402"></a> 402       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;one_module/two_module/neat&quot;.
</span><span class="marked0"><a name="line403"></a> 403       def controller_path
</span><span class="uncovered1"><a name="line404"></a> 404         @controller_path ||= name.gsub(/Controller$/, '').underscore
</span><span class="uncovered0"><a name="line405"></a> 405       end
</span><span class="inferred1"><a name="line406"></a> 406 
</span><span class="inferred0"><a name="line407"></a> 407       # Return an array containing the names of public methods that have been marked hidden from the action processor.
</span><span class="inferred1"><a name="line408"></a> 408       # By default, all methods defined in ActionController::Base and included modules are hidden.
</span><span class="inferred0"><a name="line409"></a> 409       # More methods can be hidden using &lt;tt&gt;hide_actions&lt;/tt&gt;.
</span><span class="marked1"><a name="line410"></a> 410       def hidden_actions
</span><span class="uncovered0"><a name="line411"></a> 411         unless read_inheritable_attribute(:hidden_actions)
</span><span class="uncovered1"><a name="line412"></a> 412           write_inheritable_attribute(:hidden_actions, ActionController::Base.public_instance_methods.map(&amp;:to_s))
</span><span class="uncovered0"><a name="line413"></a> 413         end
</span><span class="uncovered1"><a name="line414"></a> 414 
</span><span class="uncovered0"><a name="line415"></a> 415         read_inheritable_attribute(:hidden_actions)
</span><span class="uncovered1"><a name="line416"></a> 416       end
</span><span class="inferred0"><a name="line417"></a> 417 
</span><span class="inferred1"><a name="line418"></a> 418       # Hide each of the given methods from being callable as actions.
</span><span class="marked0"><a name="line419"></a> 419       def hide_action(*names)
</span><span class="uncovered1"><a name="line420"></a> 420         write_inheritable_attribute(:hidden_actions, hidden_actions | names.map(&amp;:to_s))
</span><span class="uncovered0"><a name="line421"></a> 421       end
</span><span class="inferred1"><a name="line422"></a> 422 
</span><span class="inferred0"><a name="line423"></a> 423       ## View load paths determine the bases from which template references can be made. So a call to
</span><span class="inferred1"><a name="line424"></a> 424       ## render(&quot;test/template&quot;) will be looked up in the view load paths array and the closest match will be
</span><span class="inferred0"><a name="line425"></a> 425       ## returned.
</span><span class="marked1"><a name="line426"></a> 426       def view_paths
</span><span class="marked0"><a name="line427"></a> 427         @view_paths || superclass.view_paths
</span><span class="marked1"><a name="line428"></a> 428       end
</span><span class="inferred0"><a name="line429"></a> 429 
</span><span class="marked1"><a name="line430"></a> 430       def view_paths=(value)
</span><span class="marked0"><a name="line431"></a> 431         @view_paths = value
</span><span class="marked1"><a name="line432"></a> 432         ActionView::TemplateFinder.process_view_paths(value)
</span><span class="inferred0"><a name="line433"></a> 433       end
</span><span class="inferred1"><a name="line434"></a> 434 
</span><span class="inferred0"><a name="line435"></a> 435       # Adds a view_path to the front of the view_paths array.
</span><span class="inferred1"><a name="line436"></a> 436       # If the current class has no view paths, copy them from
</span><span class="inferred0"><a name="line437"></a> 437       # the superclass.  This change will be visible for all future requests.
</span><span class="inferred1"><a name="line438"></a> 438       #
</span><span class="inferred0"><a name="line439"></a> 439       #   ArticleController.prepend_view_path(&quot;views/default&quot;)
</span><span class="inferred1"><a name="line440"></a> 440       #   ArticleController.prepend_view_path([&quot;views/default&quot;, &quot;views/custom&quot;])
</span><span class="inferred0"><a name="line441"></a> 441       #
</span><span class="marked1"><a name="line442"></a> 442       def prepend_view_path(path)
</span><span class="uncovered0"><a name="line443"></a> 443         @view_paths = superclass.view_paths.dup if @view_paths.nil?
</span><span class="uncovered1"><a name="line444"></a> 444         view_paths.unshift(*path)
</span><span class="uncovered0"><a name="line445"></a> 445         ActionView::TemplateFinder.process_view_paths(path)
</span><span class="uncovered1"><a name="line446"></a> 446       end
</span><span class="inferred0"><a name="line447"></a> 447 
</span><span class="inferred1"><a name="line448"></a> 448       # Adds a view_path to the end of the view_paths array.
</span><span class="inferred0"><a name="line449"></a> 449       # If the current class has no view paths, copy them from
</span><span class="inferred1"><a name="line450"></a> 450       # the superclass. This change will be visible for all future requests.
</span><span class="inferred0"><a name="line451"></a> 451       #
</span><span class="inferred1"><a name="line452"></a> 452       #   ArticleController.append_view_path(&quot;views/default&quot;)
</span><span class="inferred0"><a name="line453"></a> 453       #   ArticleController.append_view_path([&quot;views/default&quot;, &quot;views/custom&quot;])
</span><span class="inferred1"><a name="line454"></a> 454       #
</span><span class="marked0"><a name="line455"></a> 455       def append_view_path(path)
</span><span class="uncovered1"><a name="line456"></a> 456         @view_paths = superclass.view_paths.dup if @view_paths.nil?
</span><span class="uncovered0"><a name="line457"></a> 457         view_paths.push(*path)
</span><span class="uncovered1"><a name="line458"></a> 458         ActionView::TemplateFinder.process_view_paths(path)
</span><span class="uncovered0"><a name="line459"></a> 459       end
</span><span class="inferred1"><a name="line460"></a> 460 
</span><span class="inferred0"><a name="line461"></a> 461       # Replace sensitive parameter data from the request log.
</span><span class="inferred1"><a name="line462"></a> 462       # Filters parameters that have any of the arguments as a substring.
</span><span class="inferred0"><a name="line463"></a> 463       # Looks in all subhashes of the param hash for keys to filter.
</span><span class="inferred1"><a name="line464"></a> 464       # If a block is given, each key and value of the parameter hash and all
</span><span class="inferred0"><a name="line465"></a> 465       # subhashes is passed to it, the value or key
</span><span class="inferred1"><a name="line466"></a> 466       # can be replaced using String#replace or similar method.
</span><span class="inferred0"><a name="line467"></a> 467       #
</span><span class="inferred1"><a name="line468"></a> 468       # Examples:
</span><span class="inferred0"><a name="line469"></a> 469       #   filter_parameter_logging
</span><span class="inferred1"><a name="line470"></a> 470       #   =&gt; Does nothing, just slows the logging process down
</span><span class="inferred0"><a name="line471"></a> 471       #
</span><span class="inferred1"><a name="line472"></a> 472       #   filter_parameter_logging :password
</span><span class="inferred0"><a name="line473"></a> 473       #   =&gt; replaces the value to all keys matching /password/i with &quot;[FILTERED]&quot;
</span><span class="inferred1"><a name="line474"></a> 474       #
</span><span class="inferred0"><a name="line475"></a> 475       #   filter_parameter_logging :foo, &quot;bar&quot;
</span><span class="inferred1"><a name="line476"></a> 476       #   =&gt; replaces the value to all keys matching /foo|bar/i with &quot;[FILTERED]&quot;
</span><span class="inferred0"><a name="line477"></a> 477       #
</span><span class="inferred1"><a name="line478"></a> 478       #   filter_parameter_logging { |k,v| v.reverse! if k =~ /secret/i }
</span><span class="inferred0"><a name="line479"></a> 479       #   =&gt; reverses the value to all keys matching /secret/i
</span><span class="inferred1"><a name="line480"></a> 480       #
</span><span class="inferred0"><a name="line481"></a> 481       #   filter_parameter_logging(:foo, &quot;bar&quot;) { |k,v| v.reverse! if k =~ /secret/i }
</span><span class="inferred1"><a name="line482"></a> 482       #   =&gt; reverses the value to all keys matching /secret/i, and
</span><span class="inferred0"><a name="line483"></a> 483       #      replaces the value to all keys matching /foo|bar/i with &quot;[FILTERED]&quot;
</span><span class="marked1"><a name="line484"></a> 484       def filter_parameter_logging(*filter_words, &amp;block)
</span><span class="uncovered0"><a name="line485"></a> 485         parameter_filter = Regexp.new(filter_words.collect{ |s| s.to_s }.join('|'), true) if filter_words.length &gt; 0
</span><span class="uncovered1"><a name="line486"></a> 486 
</span><span class="uncovered0"><a name="line487"></a> 487         define_method(:filter_parameters) do |unfiltered_parameters|
</span><span class="uncovered1"><a name="line488"></a> 488           filtered_parameters = {}
</span><span class="uncovered0"><a name="line489"></a> 489 
</span><span class="uncovered1"><a name="line490"></a> 490           unfiltered_parameters.each do |key, value|
</span><span class="uncovered0"><a name="line491"></a> 491             if key =~ parameter_filter
</span><span class="uncovered1"><a name="line492"></a> 492               filtered_parameters[key] = '[FILTERED]'
</span><span class="uncovered0"><a name="line493"></a> 493             elsif value.is_a?(Hash)
</span><span class="uncovered1"><a name="line494"></a> 494               filtered_parameters[key] = filter_parameters(value)
</span><span class="uncovered0"><a name="line495"></a> 495             elsif block_given?
</span><span class="uncovered1"><a name="line496"></a> 496               key = key.dup
</span><span class="uncovered0"><a name="line497"></a> 497               value = value.dup if value
</span><span class="uncovered1"><a name="line498"></a> 498               yield key, value
</span><span class="uncovered0"><a name="line499"></a> 499               filtered_parameters[key] = value
</span><span class="uncovered1"><a name="line500"></a> 500             else
</span><span class="uncovered0"><a name="line501"></a> 501               filtered_parameters[key] = value
</span><span class="uncovered1"><a name="line502"></a> 502             end
</span><span class="uncovered0"><a name="line503"></a> 503           end
</span><span class="uncovered1"><a name="line504"></a> 504 
</span><span class="uncovered0"><a name="line505"></a> 505           filtered_parameters
</span><span class="uncovered1"><a name="line506"></a> 506         end
</span><span class="uncovered0"><a name="line507"></a> 507         protected :filter_parameters
</span><span class="uncovered1"><a name="line508"></a> 508       end
</span><span class="inferred0"><a name="line509"></a> 509 
</span><span class="inferred1"><a name="line510"></a> 510       # Don't render layouts for templates with the given extensions.
</span><span class="marked0"><a name="line511"></a> 511       def exempt_from_layout(*extensions)
</span><span class="uncovered1"><a name="line512"></a> 512         regexps = extensions.collect do |extension|
</span><span class="uncovered0"><a name="line513"></a> 513           extension.is_a?(Regexp) ? extension : /\.#{Regexp.escape(extension.to_s)}$/
</span><span class="uncovered1"><a name="line514"></a> 514         end
</span><span class="uncovered0"><a name="line515"></a> 515         @@exempt_from_layout.merge regexps
</span><span class="uncovered1"><a name="line516"></a> 516       end
</span><span class="uncovered0"><a name="line517"></a> 517     end
</span><span class="inferred1"><a name="line518"></a> 518 
</span><span class="marked0"><a name="line519"></a> 519     public
</span><span class="inferred1"><a name="line520"></a> 520       # Extracts the action_name from the request parameters and performs that action.
</span><span class="marked0"><a name="line521"></a> 521       def process(request, response, method = :perform_action, *arguments) #:nodoc:
</span><span class="uncovered1"><a name="line522"></a> 522         initialize_template_class(response)
</span><span class="uncovered0"><a name="line523"></a> 523         assign_shortcuts(request, response)
</span><span class="uncovered1"><a name="line524"></a> 524         initialize_current_url
</span><span class="uncovered0"><a name="line525"></a> 525         assign_names
</span><span class="uncovered1"><a name="line526"></a> 526         forget_variables_added_to_assigns
</span><span class="uncovered0"><a name="line527"></a> 527 
</span><span class="uncovered1"><a name="line528"></a> 528         log_processing
</span><span class="uncovered0"><a name="line529"></a> 529         send(method, *arguments)
</span><span class="uncovered1"><a name="line530"></a> 530 
</span><span class="uncovered0"><a name="line531"></a> 531         assign_default_content_type_and_charset
</span><span class="uncovered1"><a name="line532"></a> 532 
</span><span class="uncovered0"><a name="line533"></a> 533         response.request = request
</span><span class="uncovered1"><a name="line534"></a> 534         response.prepare! unless component_request?
</span><span class="uncovered0"><a name="line535"></a> 535         response
</span><span class="uncovered1"><a name="line536"></a> 536       ensure
</span><span class="uncovered0"><a name="line537"></a> 537         process_cleanup
</span><span class="uncovered1"><a name="line538"></a> 538       end
</span><span class="inferred0"><a name="line539"></a> 539 
</span><span class="inferred1"><a name="line540"></a> 540       # Returns a URL that has been rewritten according to the options hash and the defined Routes.
</span><span class="inferred0"><a name="line541"></a> 541       # (For doing a complete redirect, use redirect_to).
</span><span class="inferred1"><a name="line542"></a> 542       #
</span><span class="inferred0"><a name="line543"></a> 543       # &lt;tt&gt;url_for&lt;/tt&gt; is used to:
</span><span class="inferred1"><a name="line544"></a> 544       #
</span><span class="inferred0"><a name="line545"></a> 545       # All keys given to +url_for+ are forwarded to the Route module, save for the following:
</span><span class="inferred1"><a name="line546"></a> 546       # * &lt;tt&gt;:anchor&lt;/tt&gt; - Specifies the anchor name to be appended to the path. For example,
</span><span class="inferred0"><a name="line547"></a> 547       #   &lt;tt&gt;url_for :controller =&gt; 'posts', :action =&gt; 'show', :id =&gt; 10, :anchor =&gt; 'comments'&lt;/tt&gt;
</span><span class="inferred1"><a name="line548"></a> 548       #   will produce &quot;/posts/show/10#comments&quot;.
</span><span class="inferred0"><a name="line549"></a> 549       # * &lt;tt&gt;:only_path&lt;/tt&gt; - If true, returns the relative URL (omitting the protocol, host name, and port) (&lt;tt&gt;false&lt;/tt&gt; by default).
</span><span class="inferred1"><a name="line550"></a> 550       # * &lt;tt&gt;:trailing_slash&lt;/tt&gt; - If true, adds a trailing slash, as in &quot;/archive/2005/&quot;. Note that this
</span><span class="inferred0"><a name="line551"></a> 551       #   is currently not recommended since it breaks caching.
</span><span class="inferred1"><a name="line552"></a> 552       # * &lt;tt&gt;:host&lt;/tt&gt; - Overrides the default (current) host if provided.
</span><span class="inferred0"><a name="line553"></a> 553       # * &lt;tt&gt;:protocol&lt;/tt&gt; - Overrides the default (current) protocol if provided.
</span><span class="inferred1"><a name="line554"></a> 554       # * &lt;tt&gt;:port&lt;/tt&gt; - Optionally specify the port to connect to.
</span><span class="inferred0"><a name="line555"></a> 555       # * &lt;tt&gt;:user&lt;/tt&gt; - Inline HTTP authentication (only plucked out if &lt;tt&gt;:password&lt;/tt&gt; is also present).
</span><span class="inferred1"><a name="line556"></a> 556       # * &lt;tt&gt;:password&lt;/tt&gt; - Inline HTTP authentication (only plucked out if &lt;tt&gt;:user&lt;/tt&gt; is also present).
</span><span class="inferred0"><a name="line557"></a> 557       # * &lt;tt&gt;:skip_relative_url_root&lt;/tt&gt; - If true, the url is not constructed using the +relative_url_root+
</span><span class="inferred1"><a name="line558"></a> 558       #   of the request so the path will include the web server relative installation directory.
</span><span class="inferred0"><a name="line559"></a> 559       #
</span><span class="inferred1"><a name="line560"></a> 560       # The URL is generated from the remaining keys in the hash. A URL contains two key parts: the &lt;base&gt; and a query string.
</span><span class="inferred0"><a name="line561"></a> 561       # Routes composes a query string as the key/value pairs not included in the &lt;base&gt;.
</span><span class="inferred1"><a name="line562"></a> 562       #
</span><span class="inferred0"><a name="line563"></a> 563       # The default Routes setup supports a typical Rails path of &quot;controller/action/id&quot; where action and id are optional, with
</span><span class="inferred1"><a name="line564"></a> 564       # action defaulting to 'index' when not given. Here are some typical url_for statements and their corresponding URLs:
</span><span class="inferred0"><a name="line565"></a> 565       #
</span><span class="inferred1"><a name="line566"></a> 566       #   url_for :controller =&gt; 'posts', :action =&gt; 'recent'                # =&gt; 'proto://host.com/posts/recent'
</span><span class="inferred0"><a name="line567"></a> 567       #   url_for :controller =&gt; 'posts', :action =&gt; 'index'                 # =&gt; 'proto://host.com/posts'
</span><span class="inferred1"><a name="line568"></a> 568       #   url_for :controller =&gt; 'posts', :action =&gt; 'index', :port=&gt;'8033'  # =&gt; 'proto://host.com:8033/posts'
</span><span class="inferred0"><a name="line569"></a> 569       #   url_for :controller =&gt; 'posts', :action =&gt; 'show', :id =&gt; 10       # =&gt; 'proto://host.com/posts/show/10'
</span><span class="inferred1"><a name="line570"></a> 570       #   url_for :controller =&gt; 'posts', :user =&gt; 'd', :password =&gt; '123'   # =&gt; 'proto://d:123@host.com/posts'
</span><span class="inferred0"><a name="line571"></a> 571       #
</span><span class="inferred1"><a name="line572"></a> 572       # When generating a new URL, missing values may be filled in from the current request's parameters. For example,
</span><span class="inferred0"><a name="line573"></a> 573       # &lt;tt&gt;url_for :action =&gt; 'some_action'&lt;/tt&gt; will retain the current controller, as expected. This behavior extends to
</span><span class="inferred1"><a name="line574"></a> 574       # other parameters, including &lt;tt&gt;:controller&lt;/tt&gt;, &lt;tt&gt;:id&lt;/tt&gt;, and any other parameters that are placed into a Route's
</span><span class="inferred0"><a name="line575"></a> 575       # path.
</span><span class="inferred1"><a name="line576"></a> 576       #  
</span><span class="inferred0"><a name="line577"></a> 577       # The URL helpers such as &lt;tt&gt;url_for&lt;/tt&gt; have a limited form of memory: when generating a new URL, they can look for
</span><span class="inferred1"><a name="line578"></a> 578       # missing values in the current request's parameters. Routes attempts to guess when a value should and should not be
</span><span class="inferred0"><a name="line579"></a> 579       # taken from the defaults. There are a few simple rules on how this is performed:
</span><span class="inferred1"><a name="line580"></a> 580       #
</span><span class="inferred0"><a name="line581"></a> 581       # * If the controller name begins with a slash, no defaults are used: &lt;tt&gt;url_for :controller =&gt; '/home'&lt;/tt&gt;
</span><span class="inferred1"><a name="line582"></a> 582       # * If the controller changes, the action will default to index unless provided
</span><span class="inferred0"><a name="line583"></a> 583       #
</span><span class="inferred1"><a name="line584"></a> 584       # The final rule is applied while the URL is being generated and is best illustrated by an example. Let us consider the
</span><span class="inferred0"><a name="line585"></a> 585       # route given by &lt;tt&gt;map.connect 'people/:last/:first/:action', :action =&gt; 'bio', :controller =&gt; 'people'&lt;/tt&gt;.
</span><span class="inferred1"><a name="line586"></a> 586       #
</span><span class="inferred0"><a name="line587"></a> 587       # Suppose that the current URL is &quot;people/hh/david/contacts&quot;. Let's consider a few different cases of URLs which are generated
</span><span class="inferred1"><a name="line588"></a> 588       # from this page.
</span><span class="inferred0"><a name="line589"></a> 589       #
</span><span class="inferred1"><a name="line590"></a> 590       # * &lt;tt&gt;url_for :action =&gt; 'bio'&lt;/tt&gt; -- During the generation of this URL, default values will be used for the first and
</span><span class="inferred0"><a name="line591"></a> 591       # last components, and the action shall change. The generated URL will be, &quot;people/hh/david/bio&quot;.
</span><span class="inferred1"><a name="line592"></a> 592       # * &lt;tt&gt;url_for :first =&gt; 'davids-little-brother'&lt;/tt&gt; This generates the URL 'people/hh/davids-little-brother' -- note
</span><span class="inferred0"><a name="line593"></a> 593       #   that this URL leaves out the assumed action of 'bio'.
</span><span class="inferred1"><a name="line594"></a> 594       #
</span><span class="inferred0"><a name="line595"></a> 595       # However, you might ask why the action from the current request, 'contacts', isn't carried over into the new URL. The
</span><span class="inferred1"><a name="line596"></a> 596       # answer has to do with the order in which the parameters appear in the generated path. In a nutshell, since the
</span><span class="inferred0"><a name="line597"></a> 597       # value that appears in the slot for &lt;tt&gt;:first&lt;/tt&gt; is not equal to default value for &lt;tt&gt;:first&lt;/tt&gt; we stop using
</span><span class="inferred1"><a name="line598"></a> 598       # defaults. On its own, this rule can account for much of the typical Rails URL behavior.
</span><span class="inferred0"><a name="line599"></a> 599       #  
</span><span class="inferred1"><a name="line600"></a> 600       # Although a convenience, defaults can occasionally get in your way. In some cases a default persists longer than desired.
</span><span class="inferred0"><a name="line601"></a> 601       # The default may be cleared by adding &lt;tt&gt;:name =&gt; nil&lt;/tt&gt; to &lt;tt&gt;url_for&lt;/tt&gt;'s options.
</span><span class="inferred1"><a name="line602"></a> 602       # This is often required when writing form helpers, since the defaults in play may vary greatly depending upon where the
</span><span class="inferred0"><a name="line603"></a> 603       # helper is used from. The following line will redirect to PostController's default action, regardless of the page it is
</span><span class="inferred1"><a name="line604"></a> 604       # displayed on:
</span><span class="inferred0"><a name="line605"></a> 605       #
</span><span class="inferred1"><a name="line606"></a> 606       #   url_for :controller =&gt; 'posts', :action =&gt; nil
</span><span class="inferred0"><a name="line607"></a> 607       #
</span><span class="inferred1"><a name="line608"></a> 608       # If you explicitly want to create a URL that's almost the same as the current URL, you can do so using the
</span><span class="inferred0"><a name="line609"></a> 609       # &lt;tt&gt;:overwrite_params&lt;/tt&gt; options. Say for your posts you have different views for showing and printing them.
</span><span class="inferred1"><a name="line610"></a> 610       # Then, in the show view, you get the URL for the print view like this
</span><span class="inferred0"><a name="line611"></a> 611       #
</span><span class="inferred1"><a name="line612"></a> 612       #   url_for :overwrite_params =&gt; { :action =&gt; 'print' }
</span><span class="inferred0"><a name="line613"></a> 613       #
</span><span class="inferred1"><a name="line614"></a> 614       # This takes the current URL as is and only exchanges the action. In contrast, &lt;tt&gt;url_for :action =&gt; 'print'&lt;/tt&gt;
</span><span class="inferred0"><a name="line615"></a> 615       # would have slashed-off the path components after the changed action.
</span><span class="marked1"><a name="line616"></a> 616       def url_for(options = {})
</span><span class="uncovered0"><a name="line617"></a> 617         options ||= {}
</span><span class="uncovered1"><a name="line618"></a> 618         case options
</span><span class="uncovered0"><a name="line619"></a> 619           when String
</span><span class="uncovered1"><a name="line620"></a> 620             options
</span><span class="uncovered0"><a name="line621"></a> 621           when Hash
</span><span class="uncovered1"><a name="line622"></a> 622             @url.rewrite(rewrite_options(options))
</span><span class="uncovered0"><a name="line623"></a> 623           else
</span><span class="uncovered1"><a name="line624"></a> 624             polymorphic_url(options)
</span><span class="uncovered0"><a name="line625"></a> 625         end
</span><span class="uncovered1"><a name="line626"></a> 626       end
</span><span class="inferred0"><a name="line627"></a> 627 
</span><span class="inferred1"><a name="line628"></a> 628       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;NeatController&quot;.
</span><span class="marked0"><a name="line629"></a> 629       def controller_class_name
</span><span class="uncovered1"><a name="line630"></a> 630         self.class.controller_class_name
</span><span class="uncovered0"><a name="line631"></a> 631       end
</span><span class="inferred1"><a name="line632"></a> 632 
</span><span class="inferred0"><a name="line633"></a> 633       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;neat&quot;.
</span><span class="marked1"><a name="line634"></a> 634       def controller_name
</span><span class="uncovered0"><a name="line635"></a> 635         self.class.controller_name
</span><span class="uncovered1"><a name="line636"></a> 636       end
</span><span class="inferred0"><a name="line637"></a> 637 
</span><span class="inferred1"><a name="line638"></a> 638       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;one_module/two_module/neat&quot;.
</span><span class="marked0"><a name="line639"></a> 639       def controller_path
</span><span class="uncovered1"><a name="line640"></a> 640         self.class.controller_path
</span><span class="uncovered0"><a name="line641"></a> 641       end
</span><span class="inferred1"><a name="line642"></a> 642 
</span><span class="marked0"><a name="line643"></a> 643       def session_enabled?
</span><span class="uncovered1"><a name="line644"></a> 644         request.session_options &amp;&amp; request.session_options[:disabled] != false
</span><span class="uncovered0"><a name="line645"></a> 645       end
</span><span class="inferred1"><a name="line646"></a> 646 
</span><span class="marked0"><a name="line647"></a> 647       self.view_paths = []
</span><span class="inferred1"><a name="line648"></a> 648 
</span><span class="inferred0"><a name="line649"></a> 649       # View load paths for controller.
</span><span class="marked1"><a name="line650"></a> 650       def view_paths
</span><span class="uncovered0"><a name="line651"></a> 651         @template.finder.view_paths
</span><span class="uncovered1"><a name="line652"></a> 652       end
</span><span class="inferred0"><a name="line653"></a> 653 
</span><span class="marked1"><a name="line654"></a> 654       def view_paths=(value)
</span><span class="uncovered0"><a name="line655"></a> 655         @template.finder.view_paths = value  # Mutex needed
</span><span class="uncovered1"><a name="line656"></a> 656       end
</span><span class="inferred0"><a name="line657"></a> 657 
</span><span class="inferred1"><a name="line658"></a> 658       # Adds a view_path to the front of the view_paths array.
</span><span class="inferred0"><a name="line659"></a> 659       # This change affects the current request only.
</span><span class="inferred1"><a name="line660"></a> 660       #
</span><span class="inferred0"><a name="line661"></a> 661       #   self.prepend_view_path(&quot;views/default&quot;)
</span><span class="inferred1"><a name="line662"></a> 662       #   self.prepend_view_path([&quot;views/default&quot;, &quot;views/custom&quot;])
</span><span class="inferred0"><a name="line663"></a> 663       #
</span><span class="marked1"><a name="line664"></a> 664       def prepend_view_path(path)
</span><span class="uncovered0"><a name="line665"></a> 665         @template.finder.prepend_view_path(path)  # Mutex needed
</span><span class="uncovered1"><a name="line666"></a> 666       end
</span><span class="inferred0"><a name="line667"></a> 667 
</span><span class="inferred1"><a name="line668"></a> 668       # Adds a view_path to the end of the view_paths array.
</span><span class="inferred0"><a name="line669"></a> 669       # This change affects the current request only.
</span><span class="inferred1"><a name="line670"></a> 670       #
</span><span class="inferred0"><a name="line671"></a> 671       #   self.append_view_path(&quot;views/default&quot;)
</span><span class="inferred1"><a name="line672"></a> 672       #   self.append_view_path([&quot;views/default&quot;, &quot;views/custom&quot;])
</span><span class="inferred0"><a name="line673"></a> 673       #
</span><span class="marked1"><a name="line674"></a> 674       def append_view_path(path)
</span><span class="uncovered0"><a name="line675"></a> 675         @template.finder.append_view_path(path)  # Mutex needed
</span><span class="uncovered1"><a name="line676"></a> 676       end
</span><span class="inferred0"><a name="line677"></a> 677 
</span><span class="marked1"><a name="line678"></a> 678     protected
</span><span class="inferred0"><a name="line679"></a> 679       # Renders the content that will be returned to the browser as the response body.
</span><span class="inferred1"><a name="line680"></a> 680       #
</span><span class="inferred0"><a name="line681"></a> 681       # === Rendering an action
</span><span class="inferred1"><a name="line682"></a> 682       #
</span><span class="inferred0"><a name="line683"></a> 683       # Action rendering is the most common form and the type used automatically by Action Controller when nothing else is
</span><span class="inferred1"><a name="line684"></a> 684       # specified. By default, actions are rendered within the current layout (if one exists).
</span><span class="inferred0"><a name="line685"></a> 685       #
</span><span class="inferred1"><a name="line686"></a> 686       #   # Renders the template for the action &quot;goal&quot; within the current controller
</span><span class="inferred0"><a name="line687"></a> 687       #   render :action =&gt; &quot;goal&quot;
</span><span class="inferred1"><a name="line688"></a> 688       #
</span><span class="inferred0"><a name="line689"></a> 689       #   # Renders the template for the action &quot;short_goal&quot; within the current controller,
</span><span class="inferred1"><a name="line690"></a> 690       #   # but without the current active layout
</span><span class="inferred0"><a name="line691"></a> 691       #   render :action =&gt; &quot;short_goal&quot;, :layout =&gt; false
</span><span class="inferred1"><a name="line692"></a> 692       #
</span><span class="inferred0"><a name="line693"></a> 693       #   # Renders the template for the action &quot;long_goal&quot; within the current controller,
</span><span class="inferred1"><a name="line694"></a> 694       #   # but with a custom layout
</span><span class="inferred0"><a name="line695"></a> 695       #   render :action =&gt; &quot;long_goal&quot;, :layout =&gt; &quot;spectacular&quot;
</span><span class="inferred1"><a name="line696"></a> 696       #
</span><span class="inferred0"><a name="line697"></a> 697       # === Rendering partials
</span><span class="inferred1"><a name="line698"></a> 698       #
</span><span class="inferred0"><a name="line699"></a> 699       # Partial rendering in a controller is most commonly used together with Ajax calls that only update one or a few elements on a page
</span><span class="inferred1"><a name="line700"></a> 700       # without reloading. Rendering of partials from the controller makes it possible to use the same partial template in
</span><span class="inferred0"><a name="line701"></a> 701       # both the full-page rendering (by calling it from within the template) and when sub-page updates happen (from the
</span><span class="inferred1"><a name="line702"></a> 702       # controller action responding to Ajax calls). By default, the current layout is not used.
</span><span class="inferred0"><a name="line703"></a> 703       #
</span><span class="inferred1"><a name="line704"></a> 704       #   # Renders the same partial with a local variable.
</span><span class="inferred0"><a name="line705"></a> 705       #   render :partial =&gt; &quot;person&quot;, :locals =&gt; { :name =&gt; &quot;david&quot; }
</span><span class="inferred1"><a name="line706"></a> 706       #
</span><span class="inferred0"><a name="line707"></a> 707       #   # Renders the partial, making @new_person available through
</span><span class="inferred1"><a name="line708"></a> 708       #   # the local variable 'person'
</span><span class="inferred0"><a name="line709"></a> 709       #   render :partial =&gt; &quot;person&quot;, :object =&gt; @new_person
</span><span class="inferred1"><a name="line710"></a> 710       #
</span><span class="inferred0"><a name="line711"></a> 711       #   # Renders a collection of the same partial by making each element
</span><span class="inferred1"><a name="line712"></a> 712       #   # of @winners available through the local variable &quot;person&quot; as it
</span><span class="inferred0"><a name="line713"></a> 713       #   # builds the complete response.
</span><span class="inferred1"><a name="line714"></a> 714       #   render :partial =&gt; &quot;person&quot;, :collection =&gt; @winners
</span><span class="inferred0"><a name="line715"></a> 715       #
</span><span class="inferred1"><a name="line716"></a> 716       #   # Renders the same collection of partials, but also renders the
</span><span class="inferred0"><a name="line717"></a> 717       #   # person_divider partial between each person partial.
</span><span class="inferred1"><a name="line718"></a> 718       #   render :partial =&gt; &quot;person&quot;, :collection =&gt; @winners, :spacer_template =&gt; &quot;person_divider&quot;
</span><span class="inferred0"><a name="line719"></a> 719       #
</span><span class="inferred1"><a name="line720"></a> 720       #   # Renders a collection of partials located in a view subfolder
</span><span class="inferred0"><a name="line721"></a> 721       #   # outside of our current controller.  In this example we will be
</span><span class="inferred1"><a name="line722"></a> 722       #   # rendering app/views/shared/_note.r(html|xml)  Inside the partial
</span><span class="inferred0"><a name="line723"></a> 723       #   # each element of @new_notes is available as the local var &quot;note&quot;.
</span><span class="inferred1"><a name="line724"></a> 724       #   render :partial =&gt; &quot;shared/note&quot;, :collection =&gt; @new_notes
</span><span class="inferred0"><a name="line725"></a> 725       #
</span><span class="inferred1"><a name="line726"></a> 726       #   # Renders the partial with a status code of 500 (internal error).
</span><span class="inferred0"><a name="line727"></a> 727       #   render :partial =&gt; &quot;broken&quot;, :status =&gt; 500
</span><span class="inferred1"><a name="line728"></a> 728       #
</span><span class="inferred0"><a name="line729"></a> 729       # Note that the partial filename must also be a valid Ruby variable name,
</span><span class="inferred1"><a name="line730"></a> 730       # so e.g. 2005 and register-user are invalid.
</span><span class="inferred0"><a name="line731"></a> 731       #
</span><span class="inferred1"><a name="line732"></a> 732       #
</span><span class="inferred0"><a name="line733"></a> 733       # == Automatic etagging
</span><span class="inferred1"><a name="line734"></a> 734       #
</span><span class="inferred0"><a name="line735"></a> 735       # Rendering will automatically insert the etag header on 200 OK responses. The etag is calculated using MD5 of the
</span><span class="inferred1"><a name="line736"></a> 736       # response body. If a request comes in that has a matching etag, the response will be changed to a 304 Not Modified
</span><span class="inferred0"><a name="line737"></a> 737       # and the response body will be set to an empty string. No etag header will be inserted if it's already set.
</span><span class="inferred1"><a name="line738"></a> 738       #
</span><span class="inferred0"><a name="line739"></a> 739       # === Rendering a template
</span><span class="inferred1"><a name="line740"></a> 740       #
</span><span class="inferred0"><a name="line741"></a> 741       # Template rendering works just like action rendering except that it takes a path relative to the template root.
</span><span class="inferred1"><a name="line742"></a> 742       # The current layout is automatically applied.
</span><span class="inferred0"><a name="line743"></a> 743       #
</span><span class="inferred1"><a name="line744"></a> 744       #   # Renders the template located in [TEMPLATE_ROOT]/weblog/show.r(html|xml) (in Rails, app/views/weblog/show.erb)
</span><span class="inferred0"><a name="line745"></a> 745       #   render :template =&gt; &quot;weblog/show&quot;
</span><span class="inferred1"><a name="line746"></a> 746       #
</span><span class="inferred0"><a name="line747"></a> 747       #   # Renders the template with a local variable
</span><span class="inferred1"><a name="line748"></a> 748       #   render :template =&gt; &quot;weblog/show&quot;, :locals =&gt; {:customer =&gt; Customer.new}
</span><span class="inferred0"><a name="line749"></a> 749       #
</span><span class="inferred1"><a name="line750"></a> 750       # === Rendering a file
</span><span class="inferred0"><a name="line751"></a> 751       #
</span><span class="inferred1"><a name="line752"></a> 752       # File rendering works just like action rendering except that it takes a filesystem path. By default, the path
</span><span class="inferred0"><a name="line753"></a> 753       # is assumed to be absolute, and the current layout is not applied.
</span><span class="inferred1"><a name="line754"></a> 754       #
</span><span class="inferred0"><a name="line755"></a> 755       #   # Renders the template located at the absolute filesystem path
</span><span class="inferred1"><a name="line756"></a> 756       #   render :file =&gt; &quot;/path/to/some/template.erb&quot;
</span><span class="inferred0"><a name="line757"></a> 757       #   render :file =&gt; &quot;c:/path/to/some/template.erb&quot;
</span><span class="inferred1"><a name="line758"></a> 758       #
</span><span class="inferred0"><a name="line759"></a> 759       #   # Renders a template within the current layout, and with a 404 status code
</span><span class="inferred1"><a name="line760"></a> 760       #   render :file =&gt; &quot;/path/to/some/template.erb&quot;, :layout =&gt; true, :status =&gt; 404
</span><span class="inferred0"><a name="line761"></a> 761       #   render :file =&gt; &quot;c:/path/to/some/template.erb&quot;, :layout =&gt; true, :status =&gt; 404
</span><span class="inferred1"><a name="line762"></a> 762       #
</span><span class="inferred0"><a name="line763"></a> 763       #   # Renders a template relative to the template root and chooses the proper file extension
</span><span class="inferred1"><a name="line764"></a> 764       #   render :file =&gt; &quot;some/template&quot;, :use_full_path =&gt; true
</span><span class="inferred0"><a name="line765"></a> 765       #
</span><span class="inferred1"><a name="line766"></a> 766       # === Rendering text
</span><span class="inferred0"><a name="line767"></a> 767       #
</span><span class="inferred1"><a name="line768"></a> 768       # Rendering of text is usually used for tests or for rendering prepared content, such as a cache. By default, text
</span><span class="inferred0"><a name="line769"></a> 769       # rendering is not done within the active layout.
</span><span class="inferred1"><a name="line770"></a> 770       #
</span><span class="inferred0"><a name="line771"></a> 771       #   # Renders the clear text &quot;hello world&quot; with status code 200
</span><span class="inferred1"><a name="line772"></a> 772       #   render :text =&gt; &quot;hello world!&quot;
</span><span class="inferred0"><a name="line773"></a> 773       #
</span><span class="inferred1"><a name="line774"></a> 774       #   # Renders the clear text &quot;Explosion!&quot;  with status code 500
</span><span class="inferred0"><a name="line775"></a> 775       #   render :text =&gt; &quot;Explosion!&quot;, :status =&gt; 500
</span><span class="inferred1"><a name="line776"></a> 776       #
</span><span class="inferred0"><a name="line777"></a> 777       #   # Renders the clear text &quot;Hi there!&quot; within the current active layout (if one exists)
</span><span class="inferred1"><a name="line778"></a> 778       #   render :text =&gt; &quot;Hi there!&quot;, :layout =&gt; true
</span><span class="inferred0"><a name="line779"></a> 779       #
</span><span class="inferred1"><a name="line780"></a> 780       #   # Renders the clear text &quot;Hi there!&quot; within the layout
</span><span class="inferred0"><a name="line781"></a> 781       #   # placed in &quot;app/views/layouts/special.r(html|xml)&quot;
</span><span class="inferred1"><a name="line782"></a> 782       #   render :text =&gt; &quot;Hi there!&quot;, :layout =&gt; &quot;special&quot;
</span><span class="inferred0"><a name="line783"></a> 783       #
</span><span class="inferred1"><a name="line784"></a> 784       # The &lt;tt&gt;:text&lt;/tt&gt; option can also accept a Proc object, which can be used to manually control the page generation. This should
</span><span class="inferred0"><a name="line785"></a> 785       # generally be avoided, as it violates the separation between code and content, and because almost everything that can be
</span><span class="inferred1"><a name="line786"></a> 786       # done with this method can also be done more cleanly using one of the other rendering methods, most notably templates.
</span><span class="inferred0"><a name="line787"></a> 787       #
</span><span class="inferred1"><a name="line788"></a> 788       #   # Renders &quot;Hello from code!&quot;
</span><span class="inferred0"><a name="line789"></a> 789       #   render :text =&gt; proc { |response, output| output.write(&quot;Hello from code!&quot;) }
</span><span class="inferred1"><a name="line790"></a> 790       #
</span><span class="inferred0"><a name="line791"></a> 791       # === Rendering JSON
</span><span class="inferred1"><a name="line792"></a> 792       #
</span><span class="inferred0"><a name="line793"></a> 793       # Rendering JSON sets the content type to application/json and optionally wraps the JSON in a callback. It is expected
</span><span class="inferred1"><a name="line794"></a> 794       # that the response will be parsed (or eval'd) for use as a data structure.
</span><span class="inferred0"><a name="line795"></a> 795       #
</span><span class="inferred1"><a name="line796"></a> 796       #   # Renders '{&quot;name&quot;: &quot;David&quot;}'
</span><span class="inferred0"><a name="line797"></a> 797       #   render :json =&gt; {:name =&gt; &quot;David&quot;}.to_json
</span><span class="inferred1"><a name="line798"></a> 798       #
</span><span class="inferred0"><a name="line799"></a> 799       # It's not necessary to call &lt;tt&gt;to_json&lt;/tt&gt; on the object you want to render, since &lt;tt&gt;render&lt;/tt&gt; will
</span><span class="inferred1"><a name="line800"></a> 800       # automatically do that for you:
</span><span class="inferred0"><a name="line801"></a> 801       #
</span><span class="inferred1"><a name="line802"></a> 802       #   # Also renders '{&quot;name&quot;: &quot;David&quot;}'
</span><span class="inferred0"><a name="line803"></a> 803       #   render :json =&gt; {:name =&gt; &quot;David&quot;}
</span><span class="inferred1"><a name="line804"></a> 804       #
</span><span class="inferred0"><a name="line805"></a> 805       # Sometimes the result isn't handled directly by a script (such as when the request comes from a SCRIPT tag),
</span><span class="inferred1"><a name="line806"></a> 806       # so the &lt;tt&gt;:callback&lt;/tt&gt; option is provided for these cases.
</span><span class="inferred0"><a name="line807"></a> 807       #
</span><span class="inferred1"><a name="line808"></a> 808       #   # Renders 'show({&quot;name&quot;: &quot;David&quot;})'
</span><span class="inferred0"><a name="line809"></a> 809       #   render :json =&gt; {:name =&gt; &quot;David&quot;}.to_json, :callback =&gt; 'show'
</span><span class="inferred1"><a name="line810"></a> 810       #
</span><span class="inferred0"><a name="line811"></a> 811       # === Rendering an inline template
</span><span class="inferred1"><a name="line812"></a> 812       #
</span><span class="inferred0"><a name="line813"></a> 813       # Rendering of an inline template works as a cross between text and action rendering where the source for the template
</span><span class="inferred1"><a name="line814"></a> 814       # is supplied inline, like text, but its interpreted with ERb or Builder, like action. By default, ERb is used for rendering
</span><span class="inferred0"><a name="line815"></a> 815       # and the current layout is not used.
</span><span class="inferred1"><a name="line816"></a> 816       #
</span><span class="inferred0"><a name="line817"></a> 817       #   # Renders &quot;hello, hello, hello, again&quot;
</span><span class="inferred1"><a name="line818"></a> 818       #   render :inline =&gt; &quot;&lt;%= 'hello, ' * 3 + 'again' %&gt;&quot;
</span><span class="inferred0"><a name="line819"></a> 819       #
</span><span class="inferred1"><a name="line820"></a> 820       #   # Renders &quot;&lt;p&gt;Good seeing you!&lt;/p&gt;&quot; using Builder
</span><span class="inferred0"><a name="line821"></a> 821       #   render :inline =&gt; &quot;xml.p { 'Good seeing you!' }&quot;, :type =&gt; :builder
</span><span class="inferred1"><a name="line822"></a> 822       #
</span><span class="inferred0"><a name="line823"></a> 823       #   # Renders &quot;hello david&quot;
</span><span class="inferred1"><a name="line824"></a> 824       #   render :inline =&gt; &quot;&lt;%= 'hello ' + name %&gt;&quot;, :locals =&gt; { :name =&gt; &quot;david&quot; }
</span><span class="inferred0"><a name="line825"></a> 825       #
</span><span class="inferred1"><a name="line826"></a> 826       # === Rendering inline JavaScriptGenerator page updates
</span><span class="inferred0"><a name="line827"></a> 827       #
</span><span class="inferred1"><a name="line828"></a> 828       # In addition to rendering JavaScriptGenerator page updates with Ajax in RJS templates (see ActionView::Base for details),
</span><span class="inferred0"><a name="line829"></a> 829       # you can also pass the &lt;tt&gt;:update&lt;/tt&gt; parameter to +render+, along with a block, to render page updates inline.
</span><span class="inferred1"><a name="line830"></a> 830       #
</span><span class="inferred0"><a name="line831"></a> 831       #   render :update do |page|
</span><span class="inferred1"><a name="line832"></a> 832       #     page.replace_html  'user_list', :partial =&gt; 'user', :collection =&gt; @users
</span><span class="inferred0"><a name="line833"></a> 833       #     page.visual_effect :highlight, 'user_list'
</span><span class="inferred1"><a name="line834"></a> 834       #   end
</span><span class="inferred0"><a name="line835"></a> 835       #
</span><span class="inferred1"><a name="line836"></a> 836       # === Rendering with status and location headers
</span><span class="inferred0"><a name="line837"></a> 837       #
</span><span class="inferred1"><a name="line838"></a> 838       # All renders take the &lt;tt&gt;:status&lt;/tt&gt; and &lt;tt&gt;:location&lt;/tt&gt; options and turn them into headers. They can even be used together:
</span><span class="inferred0"><a name="line839"></a> 839       #
</span><span class="inferred1"><a name="line840"></a> 840       #   render :xml =&gt; post.to_xml, :status =&gt; :created, :location =&gt; post_url(post)
</span><span class="marked0"><a name="line841"></a> 841       def render(options = nil, extra_options = {}, &amp;block) #:doc:
</span><span class="uncovered1"><a name="line842"></a> 842         raise DoubleRenderError, &quot;Can only render or redirect once per action&quot; if performed?
</span><span class="uncovered0"><a name="line843"></a> 843 
</span><span class="uncovered1"><a name="line844"></a> 844         if options.nil?
</span><span class="uncovered0"><a name="line845"></a> 845           return render_for_file(default_template_name, nil, true)
</span><span class="uncovered1"><a name="line846"></a> 846         elsif !extra_options.is_a?(Hash)
</span><span class="uncovered0"><a name="line847"></a> 847           raise RenderError, &quot;You called render with invalid options : #{options.inspect}, #{extra_options.inspect}&quot;
</span><span class="uncovered1"><a name="line848"></a> 848         else
</span><span class="uncovered0"><a name="line849"></a> 849           if options == :update
</span><span class="uncovered1"><a name="line850"></a> 850             options = extra_options.merge({ :update =&gt; true })
</span><span class="uncovered0"><a name="line851"></a> 851           elsif !options.is_a?(Hash)
</span><span class="uncovered1"><a name="line852"></a> 852             raise RenderError, &quot;You called render with invalid options : #{options.inspect}&quot;
</span><span class="uncovered0"><a name="line853"></a> 853           end
</span><span class="uncovered1"><a name="line854"></a> 854         end
</span><span class="uncovered0"><a name="line855"></a> 855 
</span><span class="uncovered1"><a name="line856"></a> 856         if content_type = options[:content_type]
</span><span class="uncovered0"><a name="line857"></a> 857           response.content_type = content_type.to_s
</span><span class="uncovered1"><a name="line858"></a> 858         end
</span><span class="uncovered0"><a name="line859"></a> 859 
</span><span class="uncovered1"><a name="line860"></a> 860         if location = options[:location]
</span><span class="uncovered0"><a name="line861"></a> 861           response.headers[&quot;Location&quot;] = url_for(location)
</span><span class="uncovered1"><a name="line862"></a> 862         end
</span><span class="uncovered0"><a name="line863"></a> 863 
</span><span class="uncovered1"><a name="line864"></a> 864         if options.has_key?(:text)
</span><span class="uncovered0"><a name="line865"></a> 865           render_for_text(options[:text], options[:status])
</span><span class="uncovered1"><a name="line866"></a> 866 
</span><span class="uncovered0"><a name="line867"></a> 867         else
</span><span class="uncovered1"><a name="line868"></a> 868           if file = options[:file]
</span><span class="uncovered0"><a name="line869"></a> 869             render_for_file(file, options[:status], options[:use_full_path], options[:locals] || {})
</span><span class="uncovered1"><a name="line870"></a> 870 
</span><span class="uncovered0"><a name="line871"></a> 871           elsif template = options[:template]
</span><span class="uncovered1"><a name="line872"></a> 872             render_for_file(template, options[:status], true, options[:locals] || {})
</span><span class="uncovered0"><a name="line873"></a> 873 
</span><span class="uncovered1"><a name="line874"></a> 874           elsif inline = options[:inline]
</span><span class="uncovered0"><a name="line875"></a> 875             add_variables_to_assigns
</span><span class="uncovered1"><a name="line876"></a> 876             tmpl = ActionView::InlineTemplate.new(@template, options[:inline], options[:locals], options[:type])
</span><span class="uncovered0"><a name="line877"></a> 877             render_for_text(@template.render_template(tmpl), options[:status])
</span><span class="uncovered1"><a name="line878"></a> 878 
</span><span class="uncovered0"><a name="line879"></a> 879           elsif action_name = options[:action]
</span><span class="uncovered1"><a name="line880"></a> 880             template = default_template_name(action_name.to_s)
</span><span class="uncovered0"><a name="line881"></a> 881             if options[:layout] &amp;&amp; !template_exempt_from_layout?(template)
</span><span class="uncovered1"><a name="line882"></a> 882               render_with_a_layout(:file =&gt; template, :status =&gt; options[:status], :use_full_path =&gt; true, :layout =&gt; true)
</span><span class="uncovered0"><a name="line883"></a> 883             else
</span><span class="uncovered1"><a name="line884"></a> 884               render_with_no_layout(:file =&gt; template, :status =&gt; options[:status], :use_full_path =&gt; true)
</span><span class="uncovered0"><a name="line885"></a> 885             end
</span><span class="uncovered1"><a name="line886"></a> 886 
</span><span class="uncovered0"><a name="line887"></a> 887           elsif xml = options[:xml]
</span><span class="uncovered1"><a name="line888"></a> 888             response.content_type ||= Mime::XML
</span><span class="uncovered0"><a name="line889"></a> 889             render_for_text(xml.respond_to?(:to_xml) ? xml.to_xml : xml, options[:status])
</span><span class="uncovered1"><a name="line890"></a> 890 
</span><span class="uncovered0"><a name="line891"></a> 891           elsif json = options[:json]
</span><span class="uncovered1"><a name="line892"></a> 892             json = json.to_json unless json.is_a?(String)
</span><span class="uncovered0"><a name="line893"></a> 893             json = &quot;#{options[:callback]}(#{json})&quot; unless options[:callback].blank?
</span><span class="uncovered1"><a name="line894"></a> 894             response.content_type ||= Mime::JSON
</span><span class="uncovered0"><a name="line895"></a> 895             render_for_text(json, options[:status])
</span><span class="uncovered1"><a name="line896"></a> 896 
</span><span class="uncovered0"><a name="line897"></a> 897           elsif partial = options[:partial]
</span><span class="uncovered1"><a name="line898"></a> 898             partial = default_template_name if partial == true
</span><span class="uncovered0"><a name="line899"></a> 899             add_variables_to_assigns
</span><span class="uncovered1"><a name="line900"></a> 900 
</span><span class="uncovered0"><a name="line901"></a> 901             if collection = options[:collection]
</span><span class="uncovered1"><a name="line902"></a> 902               render_for_text(
</span><span class="uncovered0"><a name="line903"></a> 903                 @template.send!(:render_partial_collection, partial, collection,
</span><span class="uncovered1"><a name="line904"></a> 904                 options[:spacer_template], options[:locals]), options[:status]
</span><span class="uncovered0"><a name="line905"></a> 905               )
</span><span class="uncovered1"><a name="line906"></a> 906             else
</span><span class="uncovered0"><a name="line907"></a> 907               render_for_text(
</span><span class="uncovered1"><a name="line908"></a> 908                 @template.send!(:render_partial, partial,
</span><span class="uncovered0"><a name="line909"></a> 909                 ActionView::Base::ObjectWrapper.new(options[:object]), options[:locals]), options[:status]
</span><span class="uncovered1"><a name="line910"></a> 910               )
</span><span class="uncovered0"><a name="line911"></a> 911             end
</span><span class="uncovered1"><a name="line912"></a> 912 
</span><span class="uncovered0"><a name="line913"></a> 913           elsif options[:update]
</span><span class="uncovered1"><a name="line914"></a> 914             add_variables_to_assigns
</span><span class="uncovered0"><a name="line915"></a> 915             @template.send! :evaluate_assigns
</span><span class="uncovered1"><a name="line916"></a> 916 
</span><span class="uncovered0"><a name="line917"></a> 917             generator = ActionView::Helpers::PrototypeHelper::JavaScriptGenerator.new(@template, &amp;block)
</span><span class="uncovered1"><a name="line918"></a> 918             response.content_type = Mime::JS
</span><span class="uncovered0"><a name="line919"></a> 919             render_for_text(generator.to_s, options[:status])
</span><span class="uncovered1"><a name="line920"></a> 920 
</span><span class="uncovered0"><a name="line921"></a> 921           elsif options[:nothing]
</span><span class="uncovered1"><a name="line922"></a> 922             # Safari doesn't pass the headers of the return if the response is zero length
</span><span class="uncovered0"><a name="line923"></a> 923             render_for_text(&quot; &quot;, options[:status])
</span><span class="uncovered1"><a name="line924"></a> 924 
</span><span class="uncovered0"><a name="line925"></a> 925           else
</span><span class="uncovered1"><a name="line926"></a> 926             render_for_file(default_template_name, options[:status], true)
</span><span class="uncovered0"><a name="line927"></a> 927           end
</span><span class="uncovered1"><a name="line928"></a> 928         end
</span><span class="uncovered0"><a name="line929"></a> 929       end
</span><span class="inferred1"><a name="line930"></a> 930 
</span><span class="inferred0"><a name="line931"></a> 931       # Renders according to the same rules as &lt;tt&gt;render&lt;/tt&gt;, but returns the result in a string instead
</span><span class="inferred1"><a name="line932"></a> 932       # of sending it as the response body to the browser.
</span><span class="marked0"><a name="line933"></a> 933       def render_to_string(options = nil, &amp;block) #:doc:
</span><span class="uncovered1"><a name="line934"></a> 934         render(options, &amp;block)
</span><span class="uncovered0"><a name="line935"></a> 935       ensure
</span><span class="uncovered1"><a name="line936"></a> 936         erase_render_results
</span><span class="uncovered0"><a name="line937"></a> 937         forget_variables_added_to_assigns
</span><span class="uncovered1"><a name="line938"></a> 938         reset_variables_added_to_assigns
</span><span class="uncovered0"><a name="line939"></a> 939       end
</span><span class="inferred1"><a name="line940"></a> 940 
</span><span class="inferred0"><a name="line941"></a> 941       # Return a response that has no content (merely headers). The options
</span><span class="inferred1"><a name="line942"></a> 942       # argument is interpreted to be a hash of header names and values.
</span><span class="inferred0"><a name="line943"></a> 943       # This allows you to easily return a response that consists only of
</span><span class="inferred1"><a name="line944"></a> 944       # significant headers:
</span><span class="inferred0"><a name="line945"></a> 945       #
</span><span class="inferred1"><a name="line946"></a> 946       #   head :created, :location =&gt; person_path(@person)
</span><span class="inferred0"><a name="line947"></a> 947       #
</span><span class="inferred1"><a name="line948"></a> 948       # It can also be used to return exceptional conditions:
</span><span class="inferred0"><a name="line949"></a> 949       #
</span><span class="inferred1"><a name="line950"></a> 950       #   return head(:method_not_allowed) unless request.post?
</span><span class="inferred0"><a name="line951"></a> 951       #   return head(:bad_request) unless valid_request?
</span><span class="inferred1"><a name="line952"></a> 952       #   render
</span><span class="marked0"><a name="line953"></a> 953       def head(*args)
</span><span class="uncovered1"><a name="line954"></a> 954         if args.length &gt; 2
</span><span class="uncovered0"><a name="line955"></a> 955           raise ArgumentError, &quot;too many arguments to head&quot;
</span><span class="uncovered1"><a name="line956"></a> 956         elsif args.empty?
</span><span class="uncovered0"><a name="line957"></a> 957           raise ArgumentError, &quot;too few arguments to head&quot;
</span><span class="uncovered1"><a name="line958"></a> 958         end
</span><span class="uncovered0"><a name="line959"></a> 959         options = args.extract_options!
</span><span class="uncovered1"><a name="line960"></a> 960         status = interpret_status(args.shift || options.delete(:status) || :ok)
</span><span class="uncovered0"><a name="line961"></a> 961 
</span><span class="uncovered1"><a name="line962"></a> 962         options.each do |key, value|
</span><span class="uncovered0"><a name="line963"></a> 963           headers[key.to_s.dasherize.split(/-/).map { |v| v.capitalize }.join(&quot;-&quot;)] = value.to_s
</span><span class="uncovered1"><a name="line964"></a> 964         end
</span><span class="uncovered0"><a name="line965"></a> 965 
</span><span class="uncovered1"><a name="line966"></a> 966         render :nothing =&gt; true, :status =&gt; status
</span><span class="uncovered0"><a name="line967"></a> 967       end
</span><span class="inferred1"><a name="line968"></a> 968 
</span><span class="inferred0"><a name="line969"></a> 969 
</span><span class="inferred1"><a name="line970"></a> 970       # Clears the rendered results, allowing for another render to be performed.
</span><span class="marked0"><a name="line971"></a> 971       def erase_render_results #:nodoc:
</span><span class="uncovered1"><a name="line972"></a> 972         response.body = nil
</span><span class="uncovered0"><a name="line973"></a> 973         @performed_render = false
</span><span class="uncovered1"><a name="line974"></a> 974       end
</span><span class="inferred0"><a name="line975"></a> 975 
</span><span class="inferred1"><a name="line976"></a> 976       # Clears the redirected results from the headers, resets the status to 200 and returns
</span><span class="inferred0"><a name="line977"></a> 977       # the URL that was used to redirect or nil if there was no redirected URL
</span><span class="inferred1"><a name="line978"></a> 978       # Note that +redirect_to+ will change the body of the response to indicate a redirection.
</span><span class="inferred0"><a name="line979"></a> 979       # The response body is not reset here, see +erase_render_results+
</span><span class="marked1"><a name="line980"></a> 980       def erase_redirect_results #:nodoc:
</span><span class="uncovered0"><a name="line981"></a> 981         @performed_redirect = false
</span><span class="uncovered1"><a name="line982"></a> 982         response.redirected_to = nil
</span><span class="uncovered0"><a name="line983"></a> 983         response.redirected_to_method_params = nil
</span><span class="uncovered1"><a name="line984"></a> 984         response.headers['Status'] = DEFAULT_RENDER_STATUS_CODE
</span><span class="uncovered0"><a name="line985"></a> 985         response.headers.delete('Location')
</span><span class="uncovered1"><a name="line986"></a> 986       end
</span><span class="inferred0"><a name="line987"></a> 987 
</span><span class="inferred1"><a name="line988"></a> 988       # Erase both render and redirect results
</span><span class="marked0"><a name="line989"></a> 989       def erase_results #:nodoc:
</span><span class="uncovered1"><a name="line990"></a> 990         erase_render_results
</span><span class="uncovered0"><a name="line991"></a> 991         erase_redirect_results
</span><span class="uncovered1"><a name="line992"></a> 992       end
</span><span class="inferred0"><a name="line993"></a> 993 
</span><span class="marked1"><a name="line994"></a> 994       def rewrite_options(options) #:nodoc:
</span><span class="uncovered0"><a name="line995"></a> 995         if defaults = default_url_options(options)
</span><span class="uncovered1"><a name="line996"></a> 996           defaults.merge(options)
</span><span class="uncovered0"><a name="line997"></a> 997         else
</span><span class="uncovered1"><a name="line998"></a> 998           options
</span><span class="uncovered0"><a name="line999"></a> 999         end
</span><span class="uncovered1"><a name="line1000"></a>1000       end
</span><span class="inferred0"><a name="line1001"></a>1001 
</span><span class="inferred1"><a name="line1002"></a>1002       # Overwrite to implement a number of default options that all url_for-based methods will use. The default options should come in
</span><span class="inferred0"><a name="line1003"></a>1003       # the form of a hash, just like the one you would use for url_for directly. Example:
</span><span class="inferred1"><a name="line1004"></a>1004       #
</span><span class="inferred0"><a name="line1005"></a>1005       #   def default_url_options(options)
</span><span class="inferred1"><a name="line1006"></a>1006       #     { :project =&gt; @project.active? ? @project.url_name : &quot;unknown&quot; }
</span><span class="inferred0"><a name="line1007"></a>1007       #   end
</span><span class="inferred1"><a name="line1008"></a>1008       #
</span><span class="inferred0"><a name="line1009"></a>1009       # As you can infer from the example, this is mostly useful for situations where you want to centralize dynamic decisions about the
</span><span class="inferred1"><a name="line1010"></a>1010       # urls as they stem from the business domain. Please note that any individual url_for call can always override the defaults set
</span><span class="inferred0"><a name="line1011"></a>1011       # by this method.
</span><span class="marked1"><a name="line1012"></a>1012       def default_url_options(options = nil)
</span><span class="inferred0"><a name="line1013"></a>1013       end
</span><span class="inferred1"><a name="line1014"></a>1014 
</span><span class="inferred0"><a name="line1015"></a>1015       # Redirects the browser to the target specified in +options+. This parameter can take one of three forms:
</span><span class="inferred1"><a name="line1016"></a>1016       #
</span><span class="inferred0"><a name="line1017"></a>1017       # * &lt;tt&gt;Hash&lt;/tt&gt; - The URL will be generated by calling url_for with the +options+.
</span><span class="inferred1"><a name="line1018"></a>1018       # * &lt;tt&gt;Record&lt;/tt&gt; - The URL will be generated by calling url_for with the +options+, which will reference a named URL for that record.
</span><span class="inferred0"><a name="line1019"></a>1019       # * &lt;tt&gt;String starting with protocol:// (like http://)&lt;/tt&gt; - Is passed straight through as the target for redirection.
</span><span class="inferred1"><a name="line1020"></a>1020       # * &lt;tt&gt;String not containing a protocol&lt;/tt&gt; - The current protocol and host is prepended to the string.
</span><span class="inferred0"><a name="line1021"></a>1021       # * &lt;tt&gt;:back&lt;/tt&gt; - Back to the page that issued the request. Useful for forms that are triggered from multiple places.
</span><span class="inferred1"><a name="line1022"></a>1022       #   Short-hand for redirect_to(request.env[&quot;HTTP_REFERER&quot;])
</span><span class="inferred0"><a name="line1023"></a>1023       #
</span><span class="inferred1"><a name="line1024"></a>1024       # Examples:
</span><span class="inferred0"><a name="line1025"></a>1025       #   redirect_to :action =&gt; &quot;show&quot;, :id =&gt; 5
</span><span class="inferred1"><a name="line1026"></a>1026       #   redirect_to post
</span><span class="inferred0"><a name="line1027"></a>1027       #   redirect_to &quot;http://www.rubyonrails.org&quot;
</span><span class="inferred1"><a name="line1028"></a>1028       #   redirect_to &quot;/images/screenshot.jpg&quot;
</span><span class="inferred0"><a name="line1029"></a>1029       #   redirect_to articles_url
</span><span class="inferred1"><a name="line1030"></a>1030       #   redirect_to :back
</span><span class="inferred0"><a name="line1031"></a>1031       #
</span><span class="inferred1"><a name="line1032"></a>1032       # The redirection happens as a &quot;302 Moved&quot; header unless otherwise specified.
</span><span class="inferred0"><a name="line1033"></a>1033       #
</span><span class="inferred1"><a name="line1034"></a>1034       # Examples:
</span><span class="inferred0"><a name="line1035"></a>1035       #   redirect_to post_url(@post), :status=&gt;:found
</span><span class="inferred1"><a name="line1036"></a>1036       #   redirect_to :action=&gt;'atom', :status=&gt;:moved_permanently
</span><span class="inferred0"><a name="line1037"></a>1037       #   redirect_to post_url(@post), :status=&gt;301
</span><span class="inferred1"><a name="line1038"></a>1038       #   redirect_to :action=&gt;'atom', :status=&gt;302
</span><span class="inferred0"><a name="line1039"></a>1039       #
</span><span class="inferred1"><a name="line1040"></a>1040       # When using &lt;tt&gt;redirect_to :back&lt;/tt&gt;, if there is no referrer,
</span><span class="inferred0"><a name="line1041"></a>1041       # RedirectBackError will be raised. You may specify some fallback
</span><span class="inferred1"><a name="line1042"></a>1042       # behavior for this case by rescuing RedirectBackError.
</span><span class="marked0"><a name="line1043"></a>1043       def redirect_to(options = {}, response_status = {}) #:doc:
</span><span class="uncovered1"><a name="line1044"></a>1044         raise ActionControllerError.new(&quot;Cannot redirect to nil!&quot;) if options.nil?
</span><span class="uncovered0"><a name="line1045"></a>1045 
</span><span class="uncovered1"><a name="line1046"></a>1046         if options.is_a?(Hash) &amp;&amp; options[:status]
</span><span class="uncovered0"><a name="line1047"></a>1047           status = options.delete(:status)
</span><span class="uncovered1"><a name="line1048"></a>1048         elsif response_status[:status]
</span><span class="uncovered0"><a name="line1049"></a>1049           status = response_status[:status]
</span><span class="uncovered1"><a name="line1050"></a>1050         else
</span><span class="uncovered0"><a name="line1051"></a>1051           status = 302
</span><span class="uncovered1"><a name="line1052"></a>1052         end
</span><span class="uncovered0"><a name="line1053"></a>1053 
</span><span class="uncovered1"><a name="line1054"></a>1054         case options
</span><span class="uncovered0"><a name="line1055"></a>1055           when %r{^\w+://.*}
</span><span class="uncovered1"><a name="line1056"></a>1056             raise DoubleRenderError if performed?
</span><span class="uncovered0"><a name="line1057"></a>1057             logger.info(&quot;Redirected to #{options}&quot;) if logger &amp;&amp; logger.info?
</span><span class="uncovered1"><a name="line1058"></a>1058             response.redirect(options, interpret_status(status))
</span><span class="uncovered0"><a name="line1059"></a>1059             response.redirected_to = options
</span><span class="uncovered1"><a name="line1060"></a>1060             @performed_redirect = true
</span><span class="uncovered0"><a name="line1061"></a>1061 
</span><span class="uncovered1"><a name="line1062"></a>1062           when String
</span><span class="uncovered0"><a name="line1063"></a>1063             redirect_to(request.protocol + request.host_with_port + options, :status=&gt;status)
</span><span class="uncovered1"><a name="line1064"></a>1064 
</span><span class="uncovered0"><a name="line1065"></a>1065           when :back
</span><span class="uncovered1"><a name="line1066"></a>1066             request.env[&quot;HTTP_REFERER&quot;] ? redirect_to(request.env[&quot;HTTP_REFERER&quot;], :status=&gt;status) : raise(RedirectBackError)
</span><span class="uncovered0"><a name="line1067"></a>1067 
</span><span class="uncovered1"><a name="line1068"></a>1068           when Hash
</span><span class="uncovered0"><a name="line1069"></a>1069             redirect_to(url_for(options), :status=&gt;status)
</span><span class="uncovered1"><a name="line1070"></a>1070             response.redirected_to = options
</span><span class="uncovered0"><a name="line1071"></a>1071 
</span><span class="uncovered1"><a name="line1072"></a>1072           else
</span><span class="uncovered0"><a name="line1073"></a>1073             redirect_to(url_for(options), :status=&gt;status)
</span><span class="uncovered1"><a name="line1074"></a>1074         end
</span><span class="uncovered0"><a name="line1075"></a>1075       end
</span><span class="inferred1"><a name="line1076"></a>1076 
</span><span class="inferred0"><a name="line1077"></a>1077       # Sets a HTTP 1.1 Cache-Control header. Defaults to issuing a &quot;private&quot; instruction, so that
</span><span class="inferred1"><a name="line1078"></a>1078       # intermediate caches shouldn't cache the response.
</span><span class="inferred0"><a name="line1079"></a>1079       #
</span><span class="inferred1"><a name="line1080"></a>1080       # Examples:
</span><span class="inferred0"><a name="line1081"></a>1081       #   expires_in 20.minutes
</span><span class="inferred1"><a name="line1082"></a>1082       #   expires_in 3.hours, :private =&gt; false
</span><span class="inferred0"><a name="line1083"></a>1083       #   expires in 3.hours, 'max-stale' =&gt; 5.hours, :private =&gt; nil, :public =&gt; true
</span><span class="inferred1"><a name="line1084"></a>1084       #
</span><span class="inferred0"><a name="line1085"></a>1085       # This method will overwrite an existing Cache-Control header.
</span><span class="inferred1"><a name="line1086"></a>1086       # See http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html for more possibilities.
</span><span class="marked0"><a name="line1087"></a>1087       def expires_in(seconds, options = {}) #:doc:
</span><span class="uncovered1"><a name="line1088"></a>1088         cache_options = { 'max-age' =&gt; seconds, 'private' =&gt; true }.symbolize_keys.merge!(options.symbolize_keys)
</span><span class="uncovered0"><a name="line1089"></a>1089         cache_options.delete_if { |k,v| v.nil? or v == false }
</span><span class="uncovered1"><a name="line1090"></a>1090         cache_control = cache_options.map{ |k,v| v == true ? k.to_s : &quot;#{k.to_s}=#{v.to_s}&quot;}
</span><span class="uncovered0"><a name="line1091"></a>1091         response.headers[&quot;Cache-Control&quot;] = cache_control.join(', ')
</span><span class="uncovered1"><a name="line1092"></a>1092       end
</span><span class="inferred0"><a name="line1093"></a>1093 
</span><span class="inferred1"><a name="line1094"></a>1094       # Sets a HTTP 1.1 Cache-Control header of &quot;no-cache&quot; so no caching should occur by the browser or
</span><span class="inferred0"><a name="line1095"></a>1095       # intermediate caches (like caching proxy servers).
</span><span class="marked1"><a name="line1096"></a>1096       def expires_now #:doc:
</span><span class="uncovered0"><a name="line1097"></a>1097         response.headers[&quot;Cache-Control&quot;] = &quot;no-cache&quot;
</span><span class="uncovered1"><a name="line1098"></a>1098       end
</span><span class="inferred0"><a name="line1099"></a>1099 
</span><span class="inferred1"><a name="line1100"></a>1100       # Resets the session by clearing out all the objects stored within and initializing a new session object.
</span><span class="marked0"><a name="line1101"></a>1101       def reset_session #:doc:
</span><span class="uncovered1"><a name="line1102"></a>1102         request.reset_session
</span><span class="uncovered0"><a name="line1103"></a>1103         @_session = request.session
</span><span class="uncovered1"><a name="line1104"></a>1104         response.session = @_session
</span><span class="uncovered0"><a name="line1105"></a>1105       end
</span><span class="inferred1"><a name="line1106"></a>1106 
</span><span class="inferred0"><a name="line1107"></a>1107 
</span><span class="marked1"><a name="line1108"></a>1108     private
</span><span class="marked0"><a name="line1109"></a>1109       def render_for_file(template_path, status = nil, use_full_path = false, locals = {}) #:nodoc:
</span><span class="uncovered1"><a name="line1110"></a>1110         add_variables_to_assigns
</span><span class="uncovered0"><a name="line1111"></a>1111         logger.info(&quot;Rendering #{template_path}&quot; + (status ? &quot; (#{status})&quot; : '')) if logger
</span><span class="uncovered1"><a name="line1112"></a>1112         render_for_text(@template.render_file(template_path, use_full_path, locals), status)
</span><span class="uncovered0"><a name="line1113"></a>1113       end
</span><span class="inferred1"><a name="line1114"></a>1114 
</span><span class="marked0"><a name="line1115"></a>1115       def render_for_text(text = nil, status = nil, append_response = false) #:nodoc:
</span><span class="uncovered1"><a name="line1116"></a>1116         @performed_render = true
</span><span class="uncovered0"><a name="line1117"></a>1117 
</span><span class="uncovered1"><a name="line1118"></a>1118         response.headers['Status'] = interpret_status(status || DEFAULT_RENDER_STATUS_CODE)
</span><span class="uncovered0"><a name="line1119"></a>1119 
</span><span class="uncovered1"><a name="line1120"></a>1120         if append_response
</span><span class="uncovered0"><a name="line1121"></a>1121           response.body ||= ''
</span><span class="uncovered1"><a name="line1122"></a>1122           response.body &lt;&lt; text.to_s
</span><span class="uncovered0"><a name="line1123"></a>1123         else
</span><span class="uncovered1"><a name="line1124"></a>1124           response.body = text.is_a?(Proc) ? text : text.to_s
</span><span class="uncovered0"><a name="line1125"></a>1125         end
</span><span class="uncovered1"><a name="line1126"></a>1126       end
</span><span class="inferred0"><a name="line1127"></a>1127 
</span><span class="marked1"><a name="line1128"></a>1128       def initialize_template_class(response)
</span><span class="uncovered0"><a name="line1129"></a>1129         response.template = ActionView::Base.new(self.class.view_paths, {}, self)
</span><span class="uncovered1"><a name="line1130"></a>1130         response.template.extend self.class.master_helper_module
</span><span class="uncovered0"><a name="line1131"></a>1131         response.redirected_to = nil
</span><span class="uncovered1"><a name="line1132"></a>1132         @performed_render = @performed_redirect = false
</span><span class="uncovered0"><a name="line1133"></a>1133       end
</span><span class="inferred1"><a name="line1134"></a>1134 
</span><span class="marked0"><a name="line1135"></a>1135       def assign_shortcuts(request, response)
</span><span class="uncovered1"><a name="line1136"></a>1136         @_request, @_params, @_cookies = request, request.parameters, request.cookies
</span><span class="uncovered0"><a name="line1137"></a>1137 
</span><span class="uncovered1"><a name="line1138"></a>1138         @_response         = response
</span><span class="uncovered0"><a name="line1139"></a>1139         @_response.session = request.session
</span><span class="uncovered1"><a name="line1140"></a>1140 
</span><span class="uncovered0"><a name="line1141"></a>1141         @_session = @_response.session
</span><span class="uncovered1"><a name="line1142"></a>1142         @template = @_response.template
</span><span class="uncovered0"><a name="line1143"></a>1143         @assigns  = @_response.template.assigns
</span><span class="uncovered1"><a name="line1144"></a>1144 
</span><span class="uncovered0"><a name="line1145"></a>1145         @_headers = @_response.headers
</span><span class="uncovered1"><a name="line1146"></a>1146       end
</span><span class="inferred0"><a name="line1147"></a>1147 
</span><span class="marked1"><a name="line1148"></a>1148       def initialize_current_url
</span><span class="uncovered0"><a name="line1149"></a>1149         @url = UrlRewriter.new(request, params.clone)
</span><span class="uncovered1"><a name="line1150"></a>1150       end
</span><span class="inferred0"><a name="line1151"></a>1151 
</span><span class="marked1"><a name="line1152"></a>1152       def log_processing
</span><span class="uncovered0"><a name="line1153"></a>1153         if logger &amp;&amp; logger.info?
</span><span class="uncovered1"><a name="line1154"></a>1154           logger.info &quot;\n\nProcessing #{self.class.name}\##{action_name} (for #{request_origin}) [#{request.method.to_s.upcase}]&quot;
</span><span class="uncovered0"><a name="line1155"></a>1155           logger.info &quot;  Session ID: #{@_session.session_id}&quot; if @_session and @_session.respond_to?(:session_id)
</span><span class="uncovered1"><a name="line1156"></a>1156           logger.info &quot;  Parameters: #{respond_to?(:filter_parameters) ? filter_parameters(params).inspect : params.inspect}&quot;
</span><span class="uncovered0"><a name="line1157"></a>1157         end
</span><span class="uncovered1"><a name="line1158"></a>1158       end
</span><span class="inferred0"><a name="line1159"></a>1159 
</span><span class="marked1"><a name="line1160"></a>1160       def default_render #:nodoc:
</span><span class="uncovered0"><a name="line1161"></a>1161         render
</span><span class="uncovered1"><a name="line1162"></a>1162       end
</span><span class="inferred0"><a name="line1163"></a>1163 
</span><span class="marked1"><a name="line1164"></a>1164       def perform_action
</span><span class="uncovered0"><a name="line1165"></a>1165         if self.class.action_methods.include?(action_name)
</span><span class="uncovered1"><a name="line1166"></a>1166           send(action_name)
</span><span class="uncovered0"><a name="line1167"></a>1167           default_render unless performed?
</span><span class="uncovered1"><a name="line1168"></a>1168         elsif respond_to? :method_missing
</span><span class="uncovered0"><a name="line1169"></a>1169           method_missing action_name
</span><span class="uncovered1"><a name="line1170"></a>1170           default_render unless performed?
</span><span class="uncovered0"><a name="line1171"></a>1171         elsif template_exists? &amp;&amp; template_public?
</span><span class="uncovered1"><a name="line1172"></a>1172           default_render
</span><span class="uncovered0"><a name="line1173"></a>1173         else
</span><span class="uncovered1"><a name="line1174"></a>1174           raise UnknownAction, &quot;No action responded to #{action_name}&quot;, caller
</span><span class="uncovered0"><a name="line1175"></a>1175         end
</span><span class="uncovered1"><a name="line1176"></a>1176       end
</span><span class="inferred0"><a name="line1177"></a>1177 
</span><span class="marked1"><a name="line1178"></a>1178       def performed?
</span><span class="uncovered0"><a name="line1179"></a>1179         @performed_render || @performed_redirect
</span><span class="uncovered1"><a name="line1180"></a>1180       end
</span><span class="inferred0"><a name="line1181"></a>1181 
</span><span class="marked1"><a name="line1182"></a>1182       def assign_names
</span><span class="uncovered0"><a name="line1183"></a>1183         @action_name = (params['action'] || 'index')
</span><span class="uncovered1"><a name="line1184"></a>1184       end
</span><span class="inferred0"><a name="line1185"></a>1185 
</span><span class="marked1"><a name="line1186"></a>1186       def assign_default_content_type_and_charset
</span><span class="uncovered0"><a name="line1187"></a>1187         response.content_type ||= Mime::HTML
</span><span class="uncovered1"><a name="line1188"></a>1188         response.charset      ||= self.class.default_charset unless sending_file?
</span><span class="uncovered0"><a name="line1189"></a>1189       end
</span><span class="inferred1"><a name="line1190"></a>1190 
</span><span class="marked0"><a name="line1191"></a>1191       def sending_file?
</span><span class="uncovered1"><a name="line1192"></a>1192         response.headers[&quot;Content-Transfer-Encoding&quot;] == &quot;binary&quot;
</span><span class="uncovered0"><a name="line1193"></a>1193       end
</span><span class="inferred1"><a name="line1194"></a>1194 
</span><span class="marked0"><a name="line1195"></a>1195       def action_methods
</span><span class="uncovered1"><a name="line1196"></a>1196         self.class.action_methods
</span><span class="uncovered0"><a name="line1197"></a>1197       end
</span><span class="inferred1"><a name="line1198"></a>1198 
</span><span class="marked0"><a name="line1199"></a>1199       def self.action_methods
</span><span class="uncovered1"><a name="line1200"></a>1200         @action_methods ||= Set.new(public_instance_methods.map(&amp;:to_s)) - hidden_actions
</span><span class="uncovered0"><a name="line1201"></a>1201       end
</span><span class="inferred1"><a name="line1202"></a>1202 
</span><span class="marked0"><a name="line1203"></a>1203       def add_variables_to_assigns
</span><span class="uncovered1"><a name="line1204"></a>1204         unless @variables_added
</span><span class="uncovered0"><a name="line1205"></a>1205           add_instance_variables_to_assigns
</span><span class="uncovered1"><a name="line1206"></a>1206           @variables_added = true
</span><span class="uncovered0"><a name="line1207"></a>1207         end
</span><span class="uncovered1"><a name="line1208"></a>1208       end
</span><span class="inferred0"><a name="line1209"></a>1209 
</span><span class="marked1"><a name="line1210"></a>1210       def forget_variables_added_to_assigns
</span><span class="uncovered0"><a name="line1211"></a>1211         @variables_added = nil
</span><span class="uncovered1"><a name="line1212"></a>1212       end
</span><span class="inferred0"><a name="line1213"></a>1213 
</span><span class="marked1"><a name="line1214"></a>1214       def reset_variables_added_to_assigns
</span><span class="uncovered0"><a name="line1215"></a>1215         @template.instance_variable_set(&quot;@assigns_added&quot;, nil)
</span><span class="uncovered1"><a name="line1216"></a>1216       end
</span><span class="inferred0"><a name="line1217"></a>1217 
</span><span class="marked1"><a name="line1218"></a>1218       def add_instance_variables_to_assigns
</span><span class="uncovered0"><a name="line1219"></a>1219         (instance_variable_names - @@protected_view_variables).each do |var|
</span><span class="uncovered1"><a name="line1220"></a>1220           @assigns[var[1..-1]] = instance_variable_get(var)
</span><span class="uncovered0"><a name="line1221"></a>1221         end
</span><span class="uncovered1"><a name="line1222"></a>1222       end
</span><span class="inferred0"><a name="line1223"></a>1223 
</span><span class="marked1"><a name="line1224"></a>1224       def request_origin
</span><span class="uncovered0"><a name="line1225"></a>1225         # this *needs* to be cached!
</span><span class="uncovered1"><a name="line1226"></a>1226         # otherwise you'd get different results if calling it more than once
</span><span class="uncovered0"><a name="line1227"></a>1227         @request_origin ||= &quot;#{request.remote_ip} at #{Time.now.to_s(:db)}&quot;
</span><span class="uncovered1"><a name="line1228"></a>1228       end
</span><span class="inferred0"><a name="line1229"></a>1229 
</span><span class="marked1"><a name="line1230"></a>1230       def complete_request_uri
</span><span class="uncovered0"><a name="line1231"></a>1231         &quot;#{request.protocol}#{request.host}#{request.request_uri}&quot;
</span><span class="uncovered1"><a name="line1232"></a>1232       end
</span><span class="inferred0"><a name="line1233"></a>1233 
</span><span class="marked1"><a name="line1234"></a>1234       def close_session
</span><span class="uncovered0"><a name="line1235"></a>1235         @_session.close if @_session &amp;&amp; @_session.respond_to?(:close)
</span><span class="uncovered1"><a name="line1236"></a>1236       end
</span><span class="inferred0"><a name="line1237"></a>1237 
</span><span class="marked1"><a name="line1238"></a>1238       def template_exists?(template_name = default_template_name)
</span><span class="uncovered0"><a name="line1239"></a>1239         @template.finder.file_exists?(template_name)
</span><span class="uncovered1"><a name="line1240"></a>1240       end
</span><span class="inferred0"><a name="line1241"></a>1241 
</span><span class="marked1"><a name="line1242"></a>1242       def template_public?(template_name = default_template_name)
</span><span class="uncovered0"><a name="line1243"></a>1243         @template.file_public?(template_name)
</span><span class="uncovered1"><a name="line1244"></a>1244       end
</span><span class="inferred0"><a name="line1245"></a>1245 
</span><span class="marked1"><a name="line1246"></a>1246       def template_exempt_from_layout?(template_name = default_template_name)
</span><span class="uncovered0"><a name="line1247"></a>1247         extension = @template &amp;&amp; @template.finder.pick_template_extension(template_name)
</span><span class="uncovered1"><a name="line1248"></a>1248         name_with_extension = !template_name.include?('.') &amp;&amp; extension ? &quot;#{template_name}.#{extension}&quot; : template_name
</span><span class="uncovered0"><a name="line1249"></a>1249         @@exempt_from_layout.any? { |ext| name_with_extension =~ ext }
</span><span class="uncovered1"><a name="line1250"></a>1250       end
</span><span class="inferred0"><a name="line1251"></a>1251 
</span><span class="marked1"><a name="line1252"></a>1252       def default_template_name(action_name = self.action_name)
</span><span class="uncovered0"><a name="line1253"></a>1253         if action_name
</span><span class="uncovered1"><a name="line1254"></a>1254           action_name = action_name.to_s
</span><span class="uncovered0"><a name="line1255"></a>1255           if action_name.include?('/') &amp;&amp; template_path_includes_controller?(action_name)
</span><span class="uncovered1"><a name="line1256"></a>1256             action_name = strip_out_controller(action_name)
</span><span class="uncovered0"><a name="line1257"></a>1257           end
</span><span class="uncovered1"><a name="line1258"></a>1258         end
</span><span class="uncovered0"><a name="line1259"></a>1259         &quot;#{self.class.controller_path}/#{action_name}&quot;
</span><span class="uncovered1"><a name="line1260"></a>1260       end
</span><span class="inferred0"><a name="line1261"></a>1261 
</span><span class="marked1"><a name="line1262"></a>1262       def strip_out_controller(path)
</span><span class="uncovered0"><a name="line1263"></a>1263         path.split('/', 2).last
</span><span class="uncovered1"><a name="line1264"></a>1264       end
</span><span class="inferred0"><a name="line1265"></a>1265 
</span><span class="marked1"><a name="line1266"></a>1266       def template_path_includes_controller?(path)
</span><span class="uncovered0"><a name="line1267"></a>1267         self.class.controller_path.split('/')[-1] == path.split('/')[0]
</span><span class="uncovered1"><a name="line1268"></a>1268       end
</span><span class="inferred0"><a name="line1269"></a>1269 
</span><span class="marked1"><a name="line1270"></a>1270       def process_cleanup
</span><span class="uncovered0"><a name="line1271"></a>1271         close_session
</span><span class="uncovered1"><a name="line1272"></a>1272       end
</span><span class="uncovered0"><a name="line1273"></a>1273   end
</span><span class="uncovered1"><a name="line1274"></a>1274 end
</span></pre><hr/>
    <p>Generated using the <a href='http://eigenclass.org/hiki.rb?rcov'>rcov code coverage analysis tool for Ruby</a>
   version 0.8.1.2.</p>
<p><a href='http://validator.w3.org/check/referer'><img src='http://www.w3.org/Icons/valid-xhtml10' height='31' alt='Valid XHTML 1.0!' width='88'/>
        </a>
      <a href='http://jigsaw.w3.org/css-validator/check/referer'><img src='http://jigsaw.w3.org/css-validator/images/vcss' alt='Valid CSS!' style='border:0;width:88px;height:31px'/>
        </a>
      </p>
    </body>
  </html>
